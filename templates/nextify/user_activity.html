{% extends 'nextify/base.html' %}



{% block body %}
<link rel="stylesheet" href="/static/nextify/css/bs-pagination.min.css">
<style>
    .pt-100 {
        padding-top: 100px;
    }

    .pb-100 {
        padding-bottom: 100px;
    }

    .section-title {
        margin-bottom: 60px;
    }

    .section-title p {
        color: #777;
        font-size: 16px;
    }

    .section-title h4 {
        text-transform: capitalize;
        font-size: 40px;
        position: relative;
        padding-bottom: 20px;
        margin-bottom: 20px;
        font-weight: 600;
    }

    .section-title h4:before {
        position: absolute;
        content: "";
        width: 60px;
        height: 2px;
        background-color: #ff3636;
        bottom: 0;
        left: 50%;
        margin-left: -30px;
    }

    .section-title h4:after {
        position: absolute;
        background-color: #ff3636;
        content: "";
        width: 10px;
        height: 10px;
        bottom: -4px;
        left: 50%;
        margin-left: -5px;
        border-radius: 50%;
    }

    .list-group-item {
        border: 0px;
    }

    .avatar-xl {
        width: 8.125rem;
        height: 8.125rem;
    }

    .small,
    small {
        font-size: .9999rem;
    }

    h4 {
        font-size: .9999rem;
        font-weight: 450;
    }

    h2 {
        font-size: 1.5rem;
    }
    .pagination {
        display: flex
    }
</style>

<div class="header">
    <div class="container-fluid">
    </div>
</div>

<div class="container-fluid">

    <div class="row u-mb-large justify-content-center">
        <div class="col-12 col-md-12 col-xl-12 justify-content-center">

            <div class="row">

                <div class="col-12 col-lg-8">

                     <div class="card">
                    <div class="card-body">
                        <div class="row align-items-end">
                            <div class="col mb-3 ml-n3 ml-md-n2">

                                <div class="input-group input-group-lg input-group-flush input-group-merge">
                                    <input type="text" class="form-control form-control-appended"
                                           value='{{ gettext("Khach_hang") }}' class="form-control"
                                           style="font-size: 2rem" readonly>
                                    <div class="input-group-append">
                                        <div class="input-group-text">
                                            <span class="fa fa-email"></span>
                                        </div>
                                    </div>
                                </div>


                            </div>
                            <div class="col-auto">

                                <a href="{% if shop_id_select == 'all'%}/customers{% else %}/customers?loc_id={{ shop_id_select }}{% endif %}"
                                   class="btn btn-flat d-block d-md-inline-block mb-4">
                                    <i class="fe fe-x"></i> {{ gettext("Dong_lai") }}
                                </a>

                            </div>


                        </div>

                    </div>
                </div>
                    <div class="card">

                        <!-- Dropdown -->


                        <!-- Image -->


                        <!-- Body -->
                        <div class="card-header">

                            <!-- Title -->
                            <div class="row">
                                <div class="col">
                                    <h4 class="card-header-title" style="margin-top: 0.7rem">{{ gettext("Thong_tin") }}</h4>
                                </div>
                                <div class="col-auto">
                                    <a href="#user_edit_{{ cus._id }}" data-toggle="modal"
                                        class="btn btn-flat d-block d-md-inline-block"><i class="fa fa-edit"></i>
                                        {{ gettext("Chinh_sua") }}
                                    </a>


                                </div>
                            </div>

                            <!-- Button -->


                        </div>

                        <div class="card-body">

                            <!-- Image -->
                            <a href="#" class="avatar avatar-xl card-avatar card-avatar-top">
                                {% if cus.user.avatar and cus.user.avatar|length > 0 %}
                                <img class="avatar-img rounded-circle" alt="..."
                                    src="{{ cus.user.avatar.replace('http:', 'https:') }}">
                                {% else %}
                                {%set avatar = cus.user|human_avatar%}
                                <img class="avatar-img rounded-circle border border-4 border-card" src="{{ avatar }}" />
                                {% endif %}
                            </a>

                            <!-- Heading -->
                            <h2 class="card-title text-center">
                                <a href="#">
                                    <div class="name">
                                        {% if cus.user.name and cus.user.name|string != 'None' and cus.user.name|length != 0 %}
                                        {{ cus.user.name }}
                                        {% else %}

                                        {% endif %}
                                    </div>
                                </a>
                            </h2>

                            <!-- Badges -->
                            <p class="text-center">
                                <div class="text-center">
                                    {% if cus.user.user_tags_details|length> 0 %}
                                    {% for tag in cus.user.user_tags_details %}
                                        {% if tag.name|length > 0 %}
                                    <span
                                        class="badge badge-soft-{{ ['success','warning','info']|random }}"
                                        style="font-size: 13px">
                                        {{ tag.name }}
                                    {% endif %}
                                    </span>
                                    {% endfor %}
                                    {% else %}
                                    <p>N/A</p>
                                    {% endif %}
                                </div>
                            </p>


                            <!-- List group -->
                            <div class="row">
                                <div class="col-5 list-group list-group-flush mb-4">
                                    <div class="list-group-item">
                                        <div class="row align-items-center">
                                            <div class="col">

                                                <!-- Title -->
                                                <small>{{ gettext("So_dien_thoai") }}</small>

                                            </div>
                                            <div class="col-auto">

                                                <!-- Time -->
                                                <div class="small text-muted">
                                                    {{ cus.user.phone }}
                                                    {% if status_call == 'True' and cus.user.phone and merchant._id|jinja_get_name_app == 'vcall' %}
                                            <a class="fe fe-phone-call" data-toggle="modal" data-dismiss="modal" id="call_{{ cus._id }}" url="/vcall_pop_up/{{ cus._id }}" data-target="#pop_up">
                                            </a>
                                    {% endif %}
                                                </div>

                                            </div>
                                        </div> <!-- / .row -->
                                    </div>
                                    <div class="list-group-item">
                                        <div class="row align-items-center">
                                            <div class="col">

                                                <!-- Title -->
                                                <small>Email</small>

                                            </div>
                                            <div class="col-auto">

                                                <!-- Text -->
                                                <div class="text-muted">
                                                    {% if cus.user.email or cus.user.email|string !='NONE' or cus.user.email|string !='None' %}
                                                    {{ cus.user.email }}
                                                    {% else %}
                                                    N/A
                                                    {% endif %}
                                                </div>

                                            </div>
                                        </div> <!-- / .row -->
                                    </div>
                                    <div class="list-group-item">
                                        <div class="row align-items-center">
                                            <div class="col">

                                                <!-- Title -->
                                                <small>{{ gettext("Thiet_bi") }}</small>

                                            </div>
                                            <div class="col-auto">

                                                <!-- Text -->
                                                <div class="text-muted">
                                                    {{ cus.user.client_mac|length }}
                                                </div>

                                            </div>
                                        </div> <!-- / .row -->
                                    </div>
                                    <div class="list-group-item">
                                        <div class="row align-items-center">
                                            <div class="col">

                                                <!-- Title -->
                                                <small>{{ gettext("Luot_den") }}</small>

                                            </div>
                                            <div class="col-auto">

                                                <!-- Link -->
                                                <div class="small text-muted">
                                                    {{ cus.total_visit }}
                                                </div>

                                            </div>
                                        </div> <!-- / .row -->
                                    </div>
                                    <div class="list-group-item">
                                        <div class="row align-items-center">
                                            <div class="col">

                                                <!-- Title -->
                                                <small>{{ gettext("Sinh_nhat") }}</small>

                                            </div>
                                            <div class="col-auto">

                                                <!-- Link -->
                                                <div class="small text-muted">
                                                    {% if cus.user.birthday %}
                                                        {{ cus.user.birthday }}
                                                        <!-- {% if cus.user.year_birthday %}
                                                            {{ cus.user.year_birthday }}
                                                        {% else %}
                                                        {% endif %} -->
                                                    {% else %}
                                                        N/A
                                                    {% endif %}
                                                </div>

                                            </div>
                                        </div> <!-- / .row -->
                                    </div>
                                </div>
                                <div class="col-1 list-group list-group-flush mb-4"></div>
                                <div class="col-5 list-group list-group-flush mb-4">
                                    <div class="list-group-item">
                                        <div class="row align-items-center">
                                            <div class="col">

                                                <!-- Title -->
                                                <small>{{ gettext("Gioi_tinh") }}</small>

                                            </div>
                                            <div class="col-auto">

                                                <!-- Time -->
                                                <div class="small text-muted">
                                                    {% if cus.user.gender %}
                                                    {% if cus.user.gender == '2' %}
                                                        {{ gettext("Nu") }}

                                                    {% elif cus.user.gender == '1' %}
                                                    {{ gettext("Nam") }}
                                                    {% else %}
                                                    {{ gettext("Chua_xac_dinh") }}
                                                    {% endif %}
                                                    {% else %}
                                                    {{ gettext("Chua_xac_dinh") }}
                                                    {% endif %}
                                                </div>

                                            </div>
                                        </div> <!-- / .row -->
                                    </div>
                                    <!-- <div class="list-group-item">
                                        <div class="row align-items-center">
                                            <div class="col">


                                                <small>Nghề nghiệp</small>

                                            </div>
                                            <div class="col-auto">


                                                <small class="text-muted">
                                                    {% if cus.user.vocation == 1 %}
                                                    <dd>Lập trình viên</dd>
                                                    {% elif cus.user.vocation == 2 %}
                                                    <dd>Marketing</dd>
                                                    {% else %}
                                                    <dd>Khách mời</dd>
                                                    {% endif %}
                                                </small>

                                            </div>
                                        </div>
                                    </div> -->
                                    <div class="list-group-item">
                                        <div class="row align-items-center">
                                            <div class="col">

                                                <!-- Title -->
                                                <small>Social</small>

                                            </div>
                                            <div class="col-auto">

                                                <!-- Link -->
                                                <a class="small text-muted">
                                                    {% if cus.user.facebook and cus.user.facebook|string != 'None' %}
                                                    <a target="_blank" href="{{ cus.user.facebook }}">
                                                        <img src="/static/nextify/img/facebook_circle-512.png"
                                                            style="width: 30px" /></a>
                                                    {% endif %}
                                                    {% if cus.user.zalo and cus.user.zalo|string == 'true' %}
                                                    <img src="/static/nextify/img/zalo.png" style="width: 30px" />
                                                    {% endif %}
                                                </a>

                                            </div>
                                        </div> <!-- / .row -->
                                    </div>
                                    <div class="list-group-item">
                                        <div class="row align-items-center">
                                            <div class="col">

                                                <!-- Title -->
                                                <small>{{ gettext("Tong_chi_tieu") }}:</small>

                                            </div>
                                            <div class="col-auto">

                                                <!-- Link -->
                                                <div class="small text-muted">
                                                    {% if total_amount_spent %}
                                                        {{ total_amount_spent|jinja_currency_format }}

                                                    {% else %}
                                                        N/A
                                                    {% endif %}
                                                </div>

                                            </div>
                                        </div> <!-- / .row -->
                                    </div>
                                    <div class="list-group-item">
                                        <div class="row align-items-center">
                                            <div class="col">

                                                <!-- Title -->
                                                <small>{{ gettext("So_lan_mua_hang") }}:</small>

                                            </div>
                                            <div class="col-auto">

                                                <!-- Link -->
                                                <div class="small text-muted">
                                                    {% if total_order %}
                                                        {{ total_order }}

                                                    {% else %}
                                                        N/A
                                                    {% endif %}
                                                </div>

                                            </div>
                                        </div> <!-- / .row -->
                                    </div>
                                    <div class="list-group-item">
                                        <div class="row align-items-center">
                                            <div class="col">

                                                <!-- Title -->
                                                <small>{{ gettext("Lan_mua_gan_nhat") }}:</small>

                                            </div>
                                            <div class="col-auto">

                                                <!-- Link -->
                                                <div class="small text-muted">
                                                    {% if last_purchase %}
                                                        {{ last_purchase }}


                                                    {% else %}
                                                        N/A
                                                    {% endif %}
                                                </div>

                                            </div>
                                        </div> <!-- / .row -->
                                    </div>
                                    {% if cus.user.is_employee =='True' %}
                                    <div class="list-group-item">
                                        <div class="row align-items-center">
                                            <div class="col">
                                                <small>{{ gettext("Nhan_vien") }}</small>
                                            </div>
                                            <div class="col-auto">
                                                <i class="fe fe-user-check"></i>
                                            </div>
                                        </div>
                                    </div>
                                    {% endif %}
                                </div>

                            </div>

                        </div>

                    </div>

                </div>
                <script nonce="{{ csp_nonce() }}">
                $(document).ready(function() {
                    $('#call_{{ cus._id }}').click(function() {
                        $("#load_data_user").show();
                        var url = '/vcall_pop_up/' + $("#user_id").val();
                        console.log(url);
                        $.ajax({
                            url: url,
                            success: function(res) {
                                $('#div_call').empty();
                                $('#div_call').append(res);
                                $("#load_data_user").hide();
                                $('#pop_up').modal('show');

                            },
                            error: function(request, status, error) {
                                console.log("ajax call went wrong:" + request.responseText);
                            }
                        });
                    });

                })
            </script>

                <div class="col-12 col-lg-4">

                    <!-- Card -->


                    <!-- Card -->
                    <div class="card">

                        <div class="card-header">
                            <div class="row">
                                <div class="col">
                                    <a href="#" class="card-header-title" id="click_activities_customer">{{ gettext("Hanh_trinh") }}</a>
                                </div>
                                <div class="col-auto">
                                <a href="#" class="card-header-title" id="click_orders_customer">{{ gettext("Don_hang") }}</a>
                                </div>
                            </div>
                        </div>

                        <div class="card-body" id="user_activity" >
                            <div class="list-group list-group-flush list-group-activity my-n3" >
                                {% for log in logs %}
                                <div class="list-group-item">
                                    <div class="row">
                                        <div class="col-auto">

                                            <!-- Avatar -->
                                            <div class="avatar avatar-sm">
                                                <div
                                                    class="avatar-title font-size-lg bg-primary-soft rounded-circle text-primary">
                                                    <i class="fa fa-map-marker-alt"></i>
                                                </div>
                                            </div>

                                        </div>
                                        <div class="col ml-n2">


                                            <!-- Text -->
                                            <p class="small text-gray-700 mb-0">
                                                {{ gettext("Ghe_tham") }} <strong>{{ log.shop_name }}</strong> {{ log.timestamp|human_time }}
                                            </p>

                                            <!-- Time -->
                                            <small class="text-muted">
                                                {{ gettext("Vao_luc") }} <strong>{{ log.time_hour }}</strong> {{ gettext("ngay") }}
                                                <strong>{{ log.time_day }}</strong>
                                            </small>

                                        </div>
                                    </div> <!-- / .row -->
                                </div>
                                {% endfor %}
                            </div>
                            
                        </div>
                        <div class="c-pagination u-justify-center" id=user_page>
                                <ul id="example_pagination" class="pagination justify-content-center">
                                    {% if pagination %}
                                    {{ pagination.links }}
                                {% endif %}
                                </ul>
                        </div>

                        <div class="card-body" id="orders_activity" style="display: none;">
                            <div class="list-group list-group-flush my-n3">
                                {% for order in orders %}
                                <div class="list-group-item d-flex align-items-center justify-content-between px-0">
                                    <div class="row">
                                        <div class="col-auto">

                                            <!-- Avatar -->
                                            <div class="avatar avatar-sm">
                                                <div
                                                    class="avatar-title font-size-lg bg-primary-soft rounded-circle text-primary">
                                                    <i class="fa fa-shopping-cart"></i>
                                                </div>
                                            </div>

                                        </div>
                                        <div class="col ml-n2">


                                            <!-- Text -->
                                            <p class="small text-gray-700 mb-0">
                                               <strong>Thời gian:</strong>  {{ order.date_create_order }}
                                            </p>
                                            <p class="small text-gray-700 mb-0">
                                                <strong>Mã đơn hàng:</strong> {{ order.name }}
                                            </p>
                                          
                                            <a href="#detail_order_{{ order._id }}" data-toggle="modal">
                                                
                                                Chi tiết
                                            </a>

                                            <div class=" modal fade" id="detail_order_{{ order._id }}" tabindex="-1" role="dialog" style="display: none;"
                                            aria-hidden="true">
                                            <div class="modal-dialog" role="document">
                                                <div class="modal-content">
                                                     <div class="modal-card card">


                                                    <div class="card-header">
                                                        <h4 class="card-header-title">Chi tiết đơn hàng</h4>


                                                    </div>
                                                    <div class="card-body">
                                                    <div class="row no-gutters align-items-center justify-content-center">

                      <div class="col-auto">
                        <div class="display-2 mb-0">{{ order.total_price|jinja_currency_format }}</div>
                      </div>
                    </div>



                                                            <div class="mb-3">
                                                                <ul class="list-group list-group-flush">

                                                                <li class="list-group-item d-flex align-items-center justify-content-between px-0">
                                                                    <small>Mã đơn hàng</small>
                                                                    {{ order.name }}

                                                                </li>


                                                                   <li class="list-group-item d-flex align-items-center justify-content-between px-0">
                                                                        <small>Thời gian</small>{{ order.date_create_order }}
                                                                    </li>
                                                                    <li class="list-group-item d-flex align-items-center justify-content-between px-0">
                                                                        <small>Nguồn</small> {{ order.source_order }}
                                                                    </li>
                                                                   <li class="list-group-item d-flex align-items-center justify-content-between px-0">
                                                                        <small>Tiền sản phẩm</small>{{ order.total_line_items_price|jinja_currency_format }}
                                                                    </li>
                                                                    <li class="list-group-item d-flex align-items-center justify-content-between px-0">
                                                                        <small>Giảm giá</small> {{ order.total_discounts|jinja_currency_format }}
                                                                    </li>
                                                                    <li class="list-group-item d-flex align-items-center justify-content-between px-0">
                                                                        <small>Phí khác</small> {{ order.other_fees|jinja_currency_format }}
                                                                    </li>
                                                                    {% for item in order.list_items %}
                                                                   <li class="list-group-item d-flex align-items-center justify-content-between px-0">
                                                                        <small>Sản phẩm</small> {{ item.name_product}}
                                                                    </li>
                                                                    <li class="list-group-item d-flex align-items-center justify-content-between px-0">
                                                                        <small>Mã sản phẩm</small> {{ item.id_product}}
                                                                    </li>
                                                                    <li class="list-group-item d-flex align-items-center justify-content-between px-0">
                                                                        <small>Giá</small> {{ item.price|jinja_currency_format}}
                                                                    </li>
                                                                    <li class="list-group-item d-flex align-items-center justify-content-between px-0">
                                                                        <small>Số lượng</small> {{ item.quantity}}
                                                                    </li>
                                                                    {% endfor %}
                                                                </ul>
                                                            </div>
                                                    </div>
                                                     <div class="card-footer" style="text-align: center">
                                                         <button type="button" class="btn btn-danger" data-dismiss="modal" aria-label="Close">
                Đóng lại
              </button>
                                                     </div>
                                                     </div>
                                                </div>
                                            </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>



                                {% endfor %}
                            </div>

                           

                        </div>
                         <div class="c-pagination u-justify-center" id="order_page" style="display: none">
                                <ul id="order_pagination" class="pagination justify-content-center">
                                    {% if pagination %}
                                    {{ pagination.links }}
                                {% endif %}
                                </ul>
                        </div>
                        

                    </div>

                </div>

            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="pop_up" tabindex="-1" role="dialog" aria-labelledby="userDetailModal" data-backdrop="static">
    <div class="modal-dialog" role="document">

        <div class="modal-content">
            <a class="c-modal__close c-modal__close--absolute u-text-mute u-opacity-medium" data-dismiss="modal" aria-label="Close">
                <i class="fa fa-close"></i>
            </a>
            <form class="form-horizontal m-t-xs" action="" id="pop_up_call" enctype="multipart/form-data" method="post">
                <input type="hidden" name="_csrf_token" value="{{ csrf_token() }}" />
                <div class="modal-body" id="div_call">
                    <div id="load_data_user" class="loader"></div>
                </div>
            </form>

            <script type="text/javascript" nonce="{{ csp_nonce() }}">
            </script>

        </div>
    </div>
</div>
<div class=" modal fade" id="user_edit_{{ cus._id }}" tabindex="-1" role="dialog" style="display: none;"
    aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">

            <div class="modal-header">
                <h4 class="modal-title">{{ gettext("Cap_nhat_khach_hang") }}</h4>
                <a class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">×</span>
                </a>

            </div>
            <div class="modal-body">


                <form role="form" id="new_customer_fr_{{ cus._id }}" method="post"
                    action="/user/edit/{{ cus.user._id }}">
                    <input type="hidden" name="_csrf_token" value="{{ csrf_token() }}" />
                    <div class="row u-mb-medium">
                        <div class="col-lg-6">
                            <div class="form-group">
                                <label for="firstName">{{ gettext("Ten") }} (<span>
                                        <font color="red">*</font>
                                    </span> {{ gettext("bat_buoc") }})</label>
                                <input class="form-control" type="text" id="firstName_{{ cus._id }}" name="name"
                                    value="{{ cus.user.name }}" placeholder="">
                            </div>

                            <div class="form-group">
                                <label for="lastName">{{ gettext("So_dien_thoai") }} (<span>
                                        <font color="red">*</font>
                                    </span> {{ gettext("bat_buoc") }})</label>
                                <input class="form-control" type="text" placeholder="" name="phone"
                                    value="{{ cus.user.phone }}" id="new_phone_{{ cus._id }}">
                            </div>
                            <div class="form-group">
                                <label for="email">E-mail (<span>
                                        <font color="red">*</font>
                                    </span> {{ gettext("bat_buoc") }})</label>
                                <input class="form-control" type="email" name="email" id="new_email_{{ cus._id }}"
                                    value="{% if cus.user.email|string != 'None' %}{{ cus.user.email }}{% endif %}"
                                    placeholder="">
                            </div>
                            <div class="form-group">
                                <label for="email">{{ gettext("Sinh_nhat") }}</label>

                                <input type="text" class="form-control" name='birthday' id="birthday_{{ cus._id }}"
                                    value="{{ cus.user.birthday }}" />

                            </div>
                            <div class="form-group">
                                <label for="year_birth_{{ cus._id }}">{{ gettext("Nam_sinh") }}</label>
                                <input type="hidden" value="{{ cus.user.year_birthday }}"
                                    id="ex_year_birth_{{ cus._id }}" />
                                <select name="year_birth" id="year_birth_{{ cus._id }}" class="form-control">
                                    <option value="">{{ gettext("Nam_Year") }}</option>
                                    <option value="2013">2013</option>
                                    <option value="2012">2012</option>
                                    <option value="2011">2011</option>
                                    <option value="2010">2010</option>
                                    <option value="2009">2009</option>
                                    <option value="2008">2008</option>
                                    <option value="2007">2007</option>
                                    <option value="2006">2006</option>
                                    <option value="2005">2005</option>
                                    <option value="2004">2004</option>
                                    <option value="2003">2003</option>
                                    <option value="2002">2002</option>
                                    <option value="2001">2001</option>
                                    <option value="2000">2000</option>
                                    <option value="1999">1999</option>
                                    <option value="1998">1998</option>
                                    <option value="1997">1997</option>
                                    <option value="1996">1996</option>
                                    <option value="1995">1995</option>
                                    <option value="1994">1994</option>
                                    <option value="1993">1993</option>
                                    <option value="1992">1992</option>
                                    <option value="1991">1991</option>
                                    <option value="1990">1990</option>
                                    <option value="1989">1989</option>
                                    <option value="1988">1988</option>
                                    <option value="1987">1987</option>
                                    <option value="1986">1986</option>
                                    <option value="1985">1985</option>
                                    <option value="1984">1984</option>
                                    <option value="1983">1983</option>
                                    <option value="1982">1982</option>
                                    <option value="1981">1981</option>
                                    <option value="1980">1980</option>
                                    <option value="1979">1979</option>
                                    <option value="1978">1978</option>
                                    <option value="1977">1977</option>
                                    <option value="1976">1976</option>
                                    <option value="1975">1975</option>
                                    <option value="1974">1974</option>
                                    <option value="1973">1973</option>
                                    <option value="1972">1972</option>
                                    <option value="1971">1971</option>
                                    <option value="1970">1970</option>
                                    <option value="1969">1969</option>
                                    <option value="1968">1968</option>
                                    <option value="1967">1967</option>
                                    <option value="1966">1966</option>
                                    <option value="1965">1965</option>
                                    <option value="1964">1964</option>
                                    <option value="1963">1963</option>
                                    <option value="1962">1962</option>
                                    <option value="1961">1961</option>
                                    <option value="1960">1960</option>
                                    <option value="1959">1959</option>
                                    <option value="1958">1958</option>
                                    <option value="1957">1957</option>
                                    <option value="1956">1956</option>
                                    <option value="1955">1955</option>
                                    <option value="1954">1954</option>
                                    <option value="1953">1953</option>
                                    <option value="1952">1952</option>
                                    <option value="1951">1951</option>
                                    <option value="1950">1950</option>
                                    <option value="1949">1949</option>
                                    <option value="1948">1948</option>
                                    <option value="1947">1947</option>
                                    <option value="1946">1946</option>
                                    <option value="1945">1945</option>
                                    <option value="1944">1944</option>
                                    <option value="1943">1943</option>
                                    <option value="1942">1942</option>
                                    <option value="1941">1941</option>
                                    <option value="1940">1940</option>
                                    <option value="1939">1939</option>
                                    <option value="1938">1938</option>
                                    <option value="1937">1937</option>
                                    <option value="1936">1936</option>
                                    <option value="1935">1935</option>
                                    <option value="1934">1934</option>
                                    <option value="1933">1933</option>
                                    <option value="1932">1932</option>
                                    <option value="1931">1931</option>
                                    <option value="1930">1930</option>
                                    <option value="1929">1929</option>
                                    <option value="1928">1928</option>
                                    <option value="1927">1927</option>
                                    <option value="1926">1926</option>
                                    <option value="1925">1925</option>
                                    <option value="1924">1924</option>
                                    <option value="1923">1923</option>
                                    <option value="1922">1922</option>
                                    <option value="1921">1921</option>
                                    <option value="1920">1920</option>
                                    <option value="1919">1919</option>
                                    <option value="1918">1918</option>
                                    <option value="1917">1917</option>
                                    <option value="1916">1916</option>
                                    <option value="1915">1915</option>
                                    <option value="1914">1914</option>
                                    <option value="1913">1913</option>
                                    <option value="1912">1912</option>
                                    <option value="1911">1911</option>
                                    <option value="1910">1910</option>
                                    <option value="1909">1909</option>
                                    <option value="1908">1908</option>
                                    <option value="1907">1907</option>
                                    <option value="1906">1906</option>
                                    <option value="1905">1905</option>

                                </select>

                            </div>
                            <div class="form-group">
                                <label for="email">Tags</label>
                                <select class="form-control"  name="tags" style="width: 100%;"
                                    id="new_tags_selects_{{ cus._id }}" multiple="multiple">
                                    {% for tag in tags %}
                                    <option value="{{ tag._id }}" {% if tag._id in cus._id|source_tags %}selected {%  endif %}>{{ tag.name }}
                                    </option>
                                    {% endfor %}

                                </select>
                            </div>

                            <div class="form-group row">
                                <div class="col-4">
                                    <label for="email">{{ gettext("Nhan_vien") }}</label>
                                </div>
                                <div class="col-auto">
                                  <div class="custom-control custom-switch {% if cus.user.is_employee=='True' %}is-active{% endif %}" id="is_employee_div_{{ cus._id }}">
                                    <input class="custom-control-input" name="is_employee_{{ cus._id }}" id="is_employee_{{ cus._id }}" type="checkbox"
                                    {% if cus.user.is_employee=="True" %}checked="checked" {% endif %}>
                                      <label class="custom-control-label"
                                      for="is_employee_{{ cus._id }}"></label>
                                  </div>
                              </div>
                            </div>

                        </div>
                        <div class="col-lg-6">

                            <div class="form-group">
                                <label for="gender">{{ gettext("Gioi_tinh") }}</label>
                                <select class="form-control" style="width: 100%;" id="gender_{{ cus._id }}"
                                    name="gender">
                                    <option value="0">{{ gettext("Chua_xac_dinh") }}</option>
                                    <option value="1">{{ gettext("Nam") }}</option>
                                    <option value="2">{{ gettext("Nu") }}</option>
                                </select>
                            </div>
                            <input type="hidden" value="{{ cus.user.gender }}" id="current_gender_{{ cus._id }}" />


                            <div class="form-group">
                                <label  for="bio">{{ gettext("Note") }}</label>
                                <textarea class="form-control" id="bio_{{ cus._id }}"
                                    name="note">{{ cus.user.note }}</textarea>
                            </div>

                            <div class="form-group">
                                <label for="companyName">{{ gettext("Dia_chi") }}</label>
                                <input class="form-control" id="companyName_{{ cus._id }}" type="text" name="address"
                                    placeholder=""
                                    value="{% if cus.user.address|string !='None' %}{{ cus.user.address }} {% endif %}">
                            </div>
                            <div class="form-group">
                                <label for="company">{{ gettext("Cong_ty") }}</label>
                                <input class="form-control" type="text" id="company_{{ cus._id }}" name="company"
                                    placeholder=""
                                    value="{% if cus.user.company|string !='None' %}{{ cus.user.company }}{% endif %}">
                            </div>
                            <div class="form-group">
                                <label for="company">{{ gettext("Chuc_vu") }}</label>
                                <input class="form-control" type="text" id="company_role_{{ cus._id }}"
                                    name="company_role" placeholder=""
                                    value="{% if cus.user.company_role|string !='None' %}{{ cus.user.company_role }}{% endif %}">
                            </div>
                            <div class="form-group">

                                <label for="socialProfile">{{ gettext("Social_Profiles") }}</label>

                                <div class="input-group input-group-merge" style="margin-bottom: .9375rem;">

                                    <input class="form-control form-control-prepended" id="socialProfile" type="text" name="twitter"
                                    value="{{ cus.user.twitter }}">
                                    <div class="input-group-prepend">
                                        <div class="input-group-text">
                                            <span class="fe fe-twitter mr-4"></span>
                                        </div>
                                    </div>
                                </div>


                                <div class="input-group input-group-merge">
                                    <input class="form-control form-control-prepended" type="text" name="facebook" value="{{ cus.user.facebook }}">
                                    <div class="input-group-prepend">
                                        <div class="input-group-text">
                                            <span class="fe fe-facebook mr-4"></span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <input type="hidden" name="source_tags" id="source_tags_{{ cus._id }}"
                        value="{{ cus._id|source_tags }}" />

                    <input type="hidden" id="new_select_tags_filter_{{ cus._id }}" name="real_tags_filter"
                        value="{{ cus._id|source_tags|join(', ') }}" />

                </form>
                <div class="row row-centered">
                    <div class="col-12" style="text-align: center;">
                        <div class="form-group">
                            <button class="btn btn-primary" id="new_customer_{{ cus._id }}">{{ gettext("Cap_nhat") }}</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>



<input type="hidden" value="{{ total_pages_orders }}" id="total_oders">
<input type="hidden" value="{{ total_pages }}" id="total">
<input type="hidden" value="{{ page }}" id="page">
<input type="hidden" value="{{ user_id }}" id="user_id">
{% endblock %}

{% block js %}
<script src="/static/nextify/js/jquery.bootpag.min.js"></script>
<script>
    $(document).ready(function () {

        $('#example_pagination').bootpag({
            total: parseInt($("#total").val()),
            maxVisible: 2,
            firstLastUse: true,
            first: '←',
            last: '→',
            nextClass: 'next',
            prevClass: 'prev',
            lastClass: 'last',
            firstClass: 'first'
        }).on("page", function(event, /* page number here */ num){
            var user_id = $("#user_id").val();
            $.ajax({
                url: '/customer_details',
                type: "POST",
                data: {
                    'user_id': user_id,
                    'page': num,
                    'type': "user_activity"
                }
            }).done(function (response) {
                $("#orders_activity").hide();
                $("#order_page").hide();
                $("#user_activity").empty();
                $("#user_activity").append(response);
                $("#user_activity").show();
                $("#user_page").show();
            }).fail(function (error) {
            });
        });


        $('#order_pagination').bootpag({
            total: parseInt($("#total_oders").val()),
            maxVisible: 2,
            firstLastUse: true,
            first: '←',
            last: '→',
            nextClass: 'next',
            prevClass: 'prev',
            lastClass: 'last',
            firstClass: 'first'
        }).on("page", function(event, /* page number here */ num){
            var user_id = $("#user_id").val();
            $.ajax({
                url: '/customer_details',
                type: "POST",
                data: {
                    'user_id': user_id,
                    'page': num,
                    'type': "orders_activity"
                }
            }).done(function (response) {
                $("#user_activity").hide();
                $("#user_page").hide();
                $("#orders_activity").empty();
                $("#orders_activity").append(response);
                $("#orders_activity").show();
                $("#order_page").show();
            }).fail(function (error) {
            });
        });

        if ($("#current_gender_{{ cus._id }}").length > 0) {
            $("#gender_{{ cus._id }}").val($("#current_gender_{{ cus._id }}").val());
            $('#gender_{{ cus._id }}').trigger('change');
        };

        flatpickr("#birthday_{{ cus._id }}", {
            enableTime: false,
            dateFormat: "d-m"
        });

        $('#new_tags_selects_{{ cus._id }}').select2({
             dropdownAutoWidth: true,
             dropdownParent: $("#user_edit_{{ cus._id }}")
        });
        $('#year_birth_{{ cus._id }}').select2({
            dropdownAutoWidth: true,
            dropdownParent: $("#user_edit_{{ cus._id }}")
       });
       $('#gender_{{ cus._id }}').select2({
        dropdownAutoWidth: true,
        dropdownParent: $("#user_edit_{{ cus._id }}")
   });

       

        var ex_year_birth = $("#ex_year_birth_{{ cus._id }}").val();
        $("#year_birth_{{ cus._id }}").val(ex_year_birth);
        $('#year_birth_{{ cus._id }}').trigger('change');
        // var source_tags = $("#source_tags_{{ cus._id }}").val();
        // var data_soure_tags = JSON.parse(source_tags.replace(/\'/g, '"'));
        // $("#new_tags_selects_{{ cus._id }}").val(data_soure_tags);
        // $('#new_tags_selects_{{ cus._id }}').trigger('change');


        $('#new_tags_selects_{{ cus._id }}').on("change", function (e) {
            if ($('#new_tags_selects_{{ cus._id }}').val()) {
                $('#new_select_tags_filter_{{ cus._id }}').val($('#new_tags_selects_{{ cus._id }}').val().toString());
            } else {
                $('#new_select_tags_filter_{{ cus._id }}').val("");
            }
        });

        // $('#example_pagination').pagination({
        //     total: parseInt($("#total").val()),
        //     current: parseInt($("#page").val()),
        //     length: 5,
        //     size: 5,
        //     prev: "&lt;",
        //     next: "&gt;",
        //     isResetPage: true,
        //     click: function (options, refresh, $target) {
        //         var user_id = $("#user_id").val();
        //         $.ajax({
        //             url: '/customer_details',
        //             type: "POST",
        //             data: {
        //                 'user_id': user_id,
        //                 'page': options.current
        //             }
        //         }).done(function (response) {
        //             $("#user_activity").empty();
        //             $("#user_activity").append(response);
        //             $("#user_activity").show();
        //         }).fail(function (error) {
        //         });
        //     }
        // });


        $('#click_activities_customer').on("click",function(){
            $("#user_activity").show();
            $("#orders_activity").hide();
            $("#user_page").show();
            $("#order_page").hide();
        });


        $('#click_orders_customer').on("click",function(){
            $("#user_activity").hide();
            $("#orders_activity").show();
            $("#user_page").hide();
            $("#order_page").show();
        });

        $("#new_customer_{{ cus._id }}").click(function () {
            var name = $("#firstName_{{ cus._id }}").val();
            var phone = $("#new_phone_{{ cus._id }}").val();
            var email = $("#new_email_{{ cus._id }}").val();
            var birthday = $("#birthday_{{ cus._id }}").val();
            var year = $("#year_birth_{{ cus._id }}").val();
            var real_tags_filter = $("#new_tags_selects_{{ cus._id }}").val().toString();
            var company_role = $("#company_role_{{ cus._id }}").val();
            var company = $("#company_{{ cus._id }}").val();
            var location_id = $("#companyName_{{ cus._id }}").val();
            var gender = $("#gender_{{ cus._id }}").val();
            var is_employee = $("#is_employee_{{ cus._id }}").is(":checked");
            var note = $("#bio_{{ cus._id }}").val();
            var address = $("#companyName_{{ cus._id }}").val();
            var facebook = $("#facebook_{{ cus._id }}").val();
            var twitter = $("#socialProfile_{{ cus._id }}").val();

            if (name.length == 0) {
                swal('{{ gettext("Ten_khach_hang_khong_duoc_de_trong") }}', " ", "error");
                return false;

            }
            if (phone.length == 0 && email.length == 0) {
                swal('{{ gettext("So_dien_thoai_hoac_Email_khong_duoc_de_trong") }}', " ", "error");
                return false;
            }
            var data = {
                'name': name,
                'phone': phone,
                'email': email,
                'birthday': birthday,
                'year_birth': year,
                'real_tags_filter': real_tags_filter,
                'location_id': location_id,
                'gender': gender,
                'is_employee': is_employee,
                'note': note,
                'address': address,
                'facebook': facebook,
                'twitter': twitter,
                'company_role': company_role,
                'company': company
            };
            $.ajax({
                url: $("#new_customer_fr_{{ cus._id }}").attr("action"),
                type: $("#new_customer_fr_{{ cus._id }}").attr("method"),
                data: data,
                success: function (response) {
                    var returnedData = JSON.parse(response);
                    if ('error' in returnedData) {
                        swal(returnedData['error'], " ", "error");
                    } else {
                        swal('{{ gettext("Cap_nhat_khach_hang_thanh_cong") }}', '', 'success');
                        location.reload();
                    }
                },
                error: function (xhr, desc, err) {
                    swal('{{ gettext("Co_loi_xay_ra,_thu_lai_sau") }}', " ", "error");
                }
            });
            return false;
        });
    });
</script>
{% endblock %}