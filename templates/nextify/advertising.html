{% extends 'nextify/base.html' %}
{% block css %}
<link rel="stylesheet" href="/static/nextify/css/daterangepicker.css">
<style>
    .table10 td,
    .table10 th {
        padding: .9375rem;
        vertical-align: middle;
        border-top: 1px solid #edf2f9;
    }

    .table10 tbody tr:hover {
        background-color: #f5f5f5;
    }

    .table10 {
        width: 100%;
    }

    .card-text {
        width: 70%;
        color: #777;
        line-height: 20px;
        margin: 0 auto;
    }

    .empty-campaigns-message {
        margin: 140px 0;
    }

    .empty-message-header {
        color: #444;
        font-size: 14px;
        font-weight: 700;
        line-height: 17px;
        margin-bottom: 8px;
        text-align: center;
    }

    .empty-message-body {
        color: #777;
        font-size: 14px;
        font-weight: 400;
        line-height: 20px;
        margin: auto;
        text-align: center;
        max-width: 300px;
    }

    .tabs-unstyled-tab {
        -webkit-box-sizing: border-box;
        box-sizing: border-box;
        cursor: pointer;
        display: inline-block;
        height: 32px;
        margin-right: 24px;
        padding: 0 3px 16px;
    }

    .tabs-unstyled-tab.active {
        border-bottom: 2px solid #ff3c3c;
    }

    .tabs-unstyled-tab.active .tabs-unstyled-tab-name {
        color: #ff3c3c;
    }

    .tabs-unstyled-tab .tabs-unstyled-tab-name {
        color: #000;
        font-size: 14px;
        font-weight: 700;
        margin: auto;
    }

    .shadow,
    .card-profile-image img {
        box-shadow: 0 0 2rem 0 rgba(136, 152, 170, 0.65) !important;
    }

    .card {
        margin-bottom: 1.5rem;
        border-color: #edf2f9;
        box-shadow: 0 0 2rem 0 rgba(136, 152, 170, 0.65) !important;
    }

    .time-series-details-big-number {
        color: #444;
        font-size: 48px;
        font-weight: 700;
        height: 48px;
        line-height: 58px;
        margin-left: 20px;
    }

    .ncex-divider {
        border-bottom: 1px solid #eee;
    }

    .ncex-divider {
        margin: 20px 0;
    }

    .campaignName .campaign-name-row {
        padding-bottom: 20px;
        padding-left: 56px;
        padding-top: 20px;
        position: relative;
    }

    .campaignName {
        height: 60px;
        padding-right: 20px;
        padding-left: 20px;
        vertical-align: middle;
        text-align: left;
    }

    .campaignName .campaign-name-row .campaign-thumb {
        border-radius: 4px;
        -webkit-box-sizing: border-box;
        box-sizing: border-box;
        height: 44px;
        left: 0;
        overflow: hidden;
        position: absolute;
        top: 20px;
        width: 44px;
    }

    .campaignName .campaign-name-row .campaign-name {
        word-wrap: break-word;
        color:
            #000;
        font-size: 16px;
        font-weight: 700;
        line-height: 20px;
        margin-bottom: 4px;
        width: 500px;
    }

    .campaignName .campaign-name-row .campaign-dates {
        color:
            #444;
        font-size: 14px;
        line-height: 20px;
    }

    .status .status-completed {
        background-color:
            rgba(50, 50, 200, .2);
        color:
            #3232c8;
    }

    .tooltiptext {
        visibility: hidden;
        font-size: medium;
        width: 600%;
        height: 200%;
        background-color: #fb6340;
        color: #fff;
        text-align: center;
        border-radius: 6px;
        padding: 10px 0;
        position: absolute;
        z-index: 1;
    }

    .status-online:hover .tooltiptext {
        visibility: visible;
    }

    .status .status-online {
        background-color: #f10000;
        color: #0c0c0c;
    }

    .status .status-offline {
        background-color:
            #16a73594;
        color:
            #3232c8;
    }

    .status .status-pause {
        background-color:
            #fb634094;
        color:
            #1f252d;
    }

    .status .status-label {
        border-radius: 12px;
        -webkit-box-sizing: border-box;
        box-sizing: border-box;
        cursor: default;
        display: inline-block;
        font-size: 12px;
        font-weight: 500;
        height: 24px;
        line-height: 14px;
        padding: 5px 8px 5px 24px;
        position: relative;
        vertical-align: middle;
    }

    .status .status-label svg {
        left: 8px;
        margin: 0;
        padding: 0;
        position: absolute;
    }

    .status .status-completed svg {
        fill:
            #3232c8;
        height: 9px;
        top: 7px;
        width: 12px;
    }

    .campaign-metric {
        color:
            #000;
        font-size: 14px;
        font-weight: 400;
        line-height: 20px;
    }

    .campaign-metric.bold {
        font-weight: 700;
    }

    .with-tooltip-v2 {
        margin-left: 5px;
        top: 2px;
    }

    .with-tooltip-v2 .info-icon {
        display: inline-block;
        width: 17px;
        height: 17px;
        background-position: 100% 100%;
        background-repeat: no-repeat;
        background-size: 16px 16px;
        background-image: url("/static/images/ic_info.svg");
    }

    .card-text_anl {
        color:
            #958b8b;
        font-weight: 800;
        line-height: 20px;
        margin: 15px 0;
        font-size: medium;
    }

    .value {
        float: right;
    }

    .header_anl {
        font-weight: 1000;
    }

    .data-row {
        margin: 10px;
    }

    .btn-facebook {
        color: #fff;
        background-color: #3b5998;
        border-color: rgba(0, 0, 0, 0.2);
    }

    .btn-social {
        position: relative;
        padding-left: 44px;
        text-align: left;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }

    .btn-social:hover {
        color: #eee;
    }

    .btn-social :first-child {
        position: absolute;
        left: 0;
        top: 0;
        bottom: 0;
        width: 40px;
        padding: 7px;
        font-size: 1.6em;
        text-align: center;
        border-right: 1px solid rgba(0, 0, 0, 0.2);
    }

    .svg-icon {
        width: 1em;
        height: 1em;
    }

    .svg-icon path,
    .svg-icon polygon,
    .svg-icon rect {
        fill: #12263f;
    }

    .svg-icon circle {
        stroke: #4691f6;
        stroke-width: 1;
    }

    .loader1 {
        border: 6px solid #f3f3f3;
        border-top-color: rgb(243, 243, 243);
        border-top-style: solid;
        border-top-width: 2px;
        border-radius: 60%;
        border-top: 7px solid orange;
        width: 100px;
        height: 100px;
        -webkit-animation: spin 1s linear infinite;
        animation: spin 0.7s linear infinite;
        left: 50%;
        margin: auto;
        display: inline-block;
        position: fixed;
        top: 50%;
        z-index: 999;
    }
</style>
{% endblock %}
{% block main_content %}
    {% if not merchant_fb_setting %}
    <div id="walk_add_click_load" style="display: none;" class="loader1"></div>
    <div id="login_fb" style="display: block;">
        <div class="header">
            <div class="container-fluid">
                <div class="header-body">
                    <div class="row align-items-end">
                        <div class="col">
                            <!-- Pretitle -->
                            <h6 class="header-pretitle">
                                {{ gettext("Advertising") }}
                            </h6>
                            <!-- Title -->
                            <h1 class="header-title">
                                {{ gettext("Quan_ly_quang_cao") }}
                            </h1>
                        </div>

                    </div>
                </div>
            </div>
        </div>

        <div class="container-fluid">
            <div class="row" style="margin-top: 20px;">
                <div class="col-xl-6 mb-5 mb-xl-0">
                    <div class="card shadow1">
                        <div class="card-header bg-transparent">
                            <div class="row align-items-center">
                                <h2 style="line-height: 1.2;"> {{ gettext("Ban_muon_toi_uu_hoa_quang_cao?") }}</h2>
                            </div>
                        </div>

                        <div class="card-body">
                            <div class="chart">
                                <img src="/static/nextify/img/facebook_adv.jpg"
                                    style="height: inherit;width: max-content;">
                            </div>
                        </div>

                    </div>
                </div>
                <div class="col-xl-6 mb-5 mb-xl-0">
                    <div class="card shadow1">
                        <div class="card-header bg-transparent">
                            <div class="row align-items-center">
                                <div class="tabs-unstyled-tabs">
                                    <div id="analysis" class="tabs-unstyled-tab">
                                        <div class="tabs-unstyled-tab-name">
                                            <h2>{{ gettext("Cung_hop_tac_voi_chung_toi") }}</h2>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="card-text_anl"
                                style="text-align: justify;font-size: larger;line-height: 27px;font-weight: 150;color: black; margin: 13px;">
                                {{ gettext("Nextify_cung_cap_nen_tang_giup_chu_doanh_nghiep,_dia_diem_xay_dung_danh_sach_khach_hang_da_den_dia_diem,_tu_dong_hoa_marketing_va_cham_soc_khach_hang_than_thiet,_tang_them_khach_hang_moi,_va_do_luong_hieu_qua_dua_tren_khach_hang_thuc_su_da_den_thay_vi_luot_thich_va_so_lan_nhap_chuot_tren_the_gioi_so._Chung_toi_la_giai_phap_CRM_cho_nganh_dich_vu,_giup_Merchants_ket_noi_voi_khach_hang_cua_ho,_tang_doanh_thu,_kinh_doanh_thanh_cong_la_su_menh_cua_chung_toi.") }}
                                <br>
                                {{ gettext("Tinh_nang_nay_giup_cac_ban,_cac_chu_doanh_nghiep_co_the_biet_hieu_qua_quang_cao_cua_minh_de_co_the_lap_ke_hoach_cho_chien_dich_quang_cao_mot_cach_chinh_xac_nhat,_nham_dung_tap_khach_hang_muc_tieu,_tu_do_se_mang_lai_loi_nhuan_cho_doanh_nghiep.") }}

                            </div>
                            {% if not merchant_fb_setting %}

                            <button class="btn btn-lg btn-block btn-primary" id="facebook_login"
                                style="font-size: 23px;">
                                {{ gettext("Let's_start") }}
                            </button>
                            {% endif %}

                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div>

    {% endif %}

    <div id="loading" style="display: none" class="loader1"></div>
    <div id="adv_all_campaign" {% if merchant_fb_setting %} style="display: block;" {% else %} style="display: none;"
        {% endif %}>
        <div class="header">
            <div class="container-fluid">
                <div class="header-body">
                    <div class="row align-items-end">
                        <div class="col">
                            <!-- Pretitle -->
                            <h6 class="header-pretitle">
                                {{ gettext("Advertising") }}
                            </h6>
                            <!-- Title -->
                            <h1 class="header-title">
                                {{ gettext("Quan_ly_quang_cao") }}
                            </h1>
                            <input type="hidden" value="{{ merchant._id }}" id="merchant_id">
                            <div class="row align-items-center">
                                <div class="avatar avatar-lg">
                                    {% if user_info_login %}
                                    <img class="avatar-img rounded-circle"
                                        src="https://files.nextify.vn/{{ user_info_login.photo_profile }}">
                                    {% endif %}
                                </div>
                                <span class="header_anl" style="margin: 15px;">
                                    {{ user_info_login.name }}
                                </span>
                            </div>
                        </div>
                        <div class="col-xl-3" style="bottom: 5.5rem; text-align: center;">
                            <div id="reportrange" class="pull-right"
                                style="background: #fff; cursor: pointer; padding: 7px 10px; border: 1px solid #ccc; width: 100%; border-radius: 0.4rem;">
                                <i class="fa fa-calendar"></i>&nbsp;
                                <span style="font-size: medium;"></span> <i class="fa fa-caret-down"></i>
                            </div>
                        </div>
                        <div class="col-auto" style="bottom: 5.5rem;">
                            <a href="" class="btn btn-flat d-block d-md-inline-block mb-4"
                                style="position: relative;bottom: -28px;" id="logout_fb_btn">
                                <i class="fa fa-close"></i> {{ gettext("Xoa_du_lieu_dang_nhap") }}
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div id="all">
        <div class="container-fluid">
            <div class="row" style="margin-top: 20px;">
                <div class="col-xl-7 mb-5 mb-xl-0">
                    <div class="card shadow">
                        <div class="card-header bg-transparent">
                            <div class="row align-items-center">
                                <div class="tabs-unstyled-tabs">
                                    <div id="walk_throughs" class="tabs-unstyled-tab">
                                        <div class="tabs-unstyled-tab-name row">
                                            <span>{{ gettext("Luot_den_thuc") }}</span>
                                        </div>
                                    </div>
                                    <div id="add_impressions" class="tabs-unstyled-tab">
                                        <div class="tabs-unstyled-tab-name row">
                                            <span>{{ gettext("Luot_xem") }}</span>
                                        </div>
                                    </div>
                                    <div id="enga" class="tabs-unstyled-tab">
                                        <div class="tabs-unstyled-tab-name row">
                                            <span>{{ gettext("Tuong_tac") }}</span>
                                        </div>
                                    </div>
                                    <div id="clicks" class="tabs-unstyled-tab">
                                        <div class="tabs-unstyled-tab-name row">
                                            <span>Clicks</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="time-series-details-big-number" id="walk_add_click_total"><span>0</span></div>
                        <div class="ncex-divider"></div>
                        <div class="card-body">
                            <div class="chart">
                                <canvas id="walk_add_click" class="chart-canvas"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-xl-5 mb-5 mb-xl-0">
                    <div class="card shadow">
                        <div class="card-header bg-transparent">
                            <div class="row align-items-center">
                                <div class="tabs-unstyled-tabs">
                                    <div id="analysis" class="tabs-unstyled-tab">
                                        <div class="tabs-unstyled-tab-name">
                                            <h2>{{ gettext("Phan_tich") }}</h2>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="card-text_anl">
                                {{ gettext("Giup_do_cho_viec_cai_thien_hieu_qua_quang_cao,_chung_toi_dua_ra_cac_thong_ke_cua_cac_chi_so_dac_trung._Tu_do_ban_co_the_dua_ra_quyet_dinh_tot_hon,_nang_cao_hieu_suat.") }}
                            </div>
                            <div class="data-row">
                                <span class="header_anl">
                                    {{ gettext("Gioi_tinh") }}
                                </span>
                                <span class="value">
                                    {{ gettext("Nu") }}
                                </span>
                            </div>
                            <div class="data-row">
                                <span class="header_anl">
                                    {{ gettext("Tuoi") }}
                                </span>
                                <span class="value">
                                    45-54
                                </span>
                            </div>
                            <div class="data-row">
                                <span class="header_anl">
                                    {{ gettext("Thiet_bi") }}
                                </span>
                                <span class="value">
                                    Mobile
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="container-fluid">
            <div class="row u-mb-large">
                <div class="col-lg-12">
                    <div class="card">
                        <div class="table-responsive">
                            <table class="table10 v2 align-items-center table-flush">
                                <thead class="thead-light">
                                    <tr>
                                        <th>{{ gettext("Chien_dich") }}</th>
                                        <th>{{ gettext("Trang_thai") }}</th>
                                        <th id="tooltip_walk">{{ gettext("Luot_den_thuc") }}</th>
                                        <th id="tooltip_adim">{{ gettext("Luot_xem") }}</th>
                                        <th id="tooltip_click">Clicks</th>
                                        <th id="tooltip_egn">{{ gettext("Tuong_tac") }}</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% if not list_post_show %}
                                    <tr height="323">
                                        <td class="null-state" colspan="7">
                                            <div class="card-text" style="padding-top: 123px">
                                                <div class="empty-campaigns-message">
                                                    <div class="empty-message-header">
                                                        <span>{{ gettext("Khong_co_chien_dich_nao") }}</span>
                                                    </div>
                                                    <div class="empty-message-body">
                                                        <span>{{ gettext("Vui_long_kiem_tra_lai_de_co_ket_qua_chi_tiet") }}.</span>
                                                    </div>
                                                </div>
                                            </div>
                                        </td>
                                    </tr>
                                    {% else %}
                                    {% for post in list_post_show %}
                                    <tr id="campaign_{{ post.id }}">
                                        <input type="hidden" value="{{ post.id }}" id="campaign1_{{ post.id }}">
                                        <td class="campaignName">
                                            <div class="campaign-name-row">
                                                <div class="campaign-thumb is-clickable">
                                                    {% if post.photo and post.photo|length > 0 %}
                                                    <img
                                                        src="https://files.nextify.vn/{{ post.photo }}" />
                                                    {% else %}
                                                    <img src="{{ post.avatar.replace('http:', 'https:') }}" />
                                                    {% endif %}
                                                </div>
                                                {% if post.title %}
                                                <div class="campaign-name">{{ post.title|cut_name_post }}</div>
                                                {% elif post.body_name %}
                                                <div class="campaign-name">{{ post.body_name|cut_name_post }}</div>
                                                {% else %}
                                                <div class="campaign-name">{{ post.name|cut_name_post }}</div>
                                                {% endif %}
                                                <div class="campaign-dates">{{ gettext("Tao_luc") }}: {{ post.create_time }}</div>
                                                <div class="campaign-dates">{{ gettext("Hoan_thanh") }}: {% if post.completed_time %}
                                                    {{ post.completed_time }} {% endif %}</div>
                                            </div>
                                        </td>
                                        <td class="status">
                                            {% if post.status == "PAUSED" %}
                                            <span class="status-label status-pause"><svg class="svg-icon"
                                                    viewBox="0 0 20 20">
                                                    <path fill="none"
                                                        d="M11.469,10l7.08-7.08c0.406-0.406,0.406-1.064,0-1.469c-0.406-0.406-1.063-0.406-1.469,0L10,8.53l-7.081-7.08
                                                c-0.406-0.406-1.064-0.406-1.469,0c-0.406,0.406-0.406,1.063,0,1.469L8.531,10L1.45,17.081c-0.406,0.406-0.406,1.064,0,1.469
                                                c0.203,0.203,0.469,0.304,0.735,0.304c0.266,0,0.531-0.101,0.735-0.304L10,11.469l7.08,7.081c0.203,0.203,0.469,0.304,0.735,0.304
                                                c0.267,0,0.532-0.101,0.735-0.304c0.406-0.406,0.406-1.064,0-1.469L11.469,10z"></path>
                                                </svg>
                                                <span>{{ gettext("Tam_dung") }}</span>
                                            </span>
                                            {% else %}
                                            <span class="status-label status-completed">
                                                <svg width="12" height="9" viewBox="0 0 12 9">
                                                    <polygon fill-rule="evenodd"
                                                        points="17.995 8 11.873 14.122 9.299 11.547 8 12.847 11.873 16.72 19.294 9.299"
                                                        transform="translate(-8 -8)"></polygon>
                                                </svg>
                                                <span>{{ gettext("Hoan_thanh") }}</span>
                                            </span>
                                            {% if post.tracking_specs == "offline_conversion" %}
                                            <span class="status-label status-offline">
                                                <svg width="12" height="9" viewBox="0 0 12 9">
                                                    <polygon fill-rule="evenodd"
                                                        points="17.995 8 11.873 14.122 9.299 11.547 8 12.847 11.873 16.72 19.294 9.299"
                                                        transform="translate(-8 -8)"></polygon>
                                                </svg>
                                                <span>ON</span>
                                            </span>
                                            {% else %}
                                            <span class="status-label status-online"><svg class="svg-icon"
                                                    viewBox="0 0 20 20">
                                                    <path fill="none"
                                                        d="M11.469,10l7.08-7.08c0.406-0.406,0.406-1.064,0-1.469c-0.406-0.406-1.063-0.406-1.469,0L10,8.53l-7.081-7.08
                                                c-0.406-0.406-1.064-0.406-1.469,0c-0.406,0.406-0.406,1.063,0,1.469L8.531,10L1.45,17.081c-0.406,0.406-0.406,1.064,0,1.469
                                                c0.203,0.203,0.469,0.304,0.735,0.304c0.266,0,0.531-0.101,0.735-0.304L10,11.469l7.08,7.081c0.203,0.203,0.469,0.304,0.735,0.304
                                                c0.267,0,0.532-0.101,0.735-0.304c0.406-0.406,0.406-1.064,0-1.469L11.469,10z">
                                                    </path>
                                                </svg>
                                                <span>OFF</span>
                                                <span class="tooltiptext">{{ gettext("Chua_kich_hoat_tinh_nang_offline_conversation_cho_bai_dang_nay") }}</span>
                                            </span>

                                            {% endif %}
                                            {% endif %}
                                        </td>
                                        <td class="estWalk">
                                            <div class="campaign-metric bold"><span>0</span></div>
                                        </td>
                                        <td class="impressions">
                                            <div class="campaign-metric"><span>{{ post.impressions }}</span></div>
                                        </td>
                                        <td class="clicks">
                                            <div class="campaign-metric"><span>{{ post.clicks }}</span></div>
                                        </td>
                                        <td class="engagement">
                                            <div class="campaign-metric"><span>{{ post.post_engagement }}</span></div>
                                        </td>

                                    </tr>
                                    <script nonce="{{ csp_nonce() }}">
                                        $(document).ready(function () {
                                            $("#campaign_{{ post.id }}").click(function () {
                                                var campaign_id = $('#campaign1_{{ post.id }}').val();
                                                $.ajax({
                                                    url: "/get_data_campaign",
                                                    data: {
                                                        'campaign_id': campaign_id,
                                                        'date_preset': 'this_month',
                                                        'merchant_id': $("#merchant_id").val()
                                                    },
                                                    success: function (res) {
                                                        $("#adv_all_campaign").empty();
                                                        $('#adv_all_campaign').append(res);

                                                    },
                                                    error: function (request, status, error) {
                                                        console.log("ajax call went wrong:" + request.responseText);
                                                    }
                                                });

                                            })
                                        })
                                    </script>
                                    {% endfor %}
                                    {% endif %}
                                </tbody>
                            </table>
                            <script nonce="{{ csp_nonce() }}">

                                function statusChangeCallback(response) {  // Called with the results from FB.getLoginStatus().
                                    var response1 = response;
                                    if (response.status === 'connected') {   // Logged into your webpage and Facebook.
                                        $.ajax({
                                            url: '/fb_callback',
                                            type: 'POST',
                                            data: {
                                                'data': JSON.stringify(response1),
                                                'merchant_id': $("#merchant_id").val()
                                            },
                                            success: function (response_ajax) {
                                                var returnedData = JSON.parse(response_ajax);
                                                swal('{{ gettext("Dang_nhap_voi_Facebook_thanh_cong") }}', "", "success");
                                                $("#walk_add_click_load").hide();
                                                location.href = returnedData['url'];

                                            },
                                            error: function (xhr, desc, err) {
                                                swal('{{ gettext("Co_loi_xay_ra,_thu_lai_sau") }}', " ", "error");

                                            }
                                        });
                                    } else {                                 // Not logged into your webpage or we are unable to tell.
                                        document.getElementById('status').innerHTML = 'Please log ' +
                                            'into this webpage.';
                                    }
                                };


                                $("#facebook_login").click(function () {
                                       $("#walk_add_click_load").show();
                                    FB.init({
                                        appId: '611214335939430',
                                        cookie: true,                     // Enable cookies to allow the server to access the session.
                                        xfbml: true,                     // Parse social plugins on this webpage.
                                        version: 'v5.0'           // Use this Graph API version for this call.
                                    });
                                    FB.login(function (response) {
                                        testAPI()
                                    }, {
                                        scope: 'public_profile,email,ads_management,manage_pages',
                                    });

                                    // };

                                });
                                $("#logout_fb_btn").click(function () {
                                    var merchant_id = $("#merchant_id").val();
                                    console.log(merchant_id);
                                    $.ajax({
                                        url: '/advertising_logout?merchant_id=' + merchant_id,
                                        type: 'GET',
                                        success: function (response_ajax) {
                                            var returnedData = JSON.parse(response_ajax);
                                            swal('{{ gettext("Dang_xuat_thanh_cong") }}', "", "success");
                                            FB.logout(function (response) {
                                            });
                                            location.href = returnedData['url'];
                                        },
                                        error: function (xhr, desc, err) {
                                            swal('{{ gettext("Dang_xuat_thanh_cong") }}', "", "success");
                                        }
                                    });
                                });


                                (function (d, s, id) {                      // Load the SDK asynchronously
                                    var js, fjs = d.getElementsByTagName(s)[0];
                                    if (d.getElementById(id)) return;
                                    js = d.createElement(s); js.id = id;
                                    js.src = "https://connect.facebook.net/en_US/sdk.js";
                                    fjs.parentNode.insertBefore(js, fjs);
                                }(document, 'script', 'facebook-jssdk'));

                                function testAPI() {                      // Testing Graph API after login.  See statusChangeCallback() for when this call is made.
                                    FB.api('/me/permissions', function (response) {
                                        var results = false;
                                        for (i = 0; i < 3; i++) {
                                            if (response.data[i].status != "granted") {
                                                swal('{{ gettext("Hay_cap_quyen_cho_ung_dung_cua_chung_toi_de_duoc_phuc_vu_tot_nhat") }}', "", "warning");
                                                  return false;
                                            }
                                        };
                                        FB.getLoginStatus(function (response) {   // Called after the JS SDK has been initialized.
                                            statusChangeCallback(response);        // Returns the login status.
                                        });
                                    },
                                        {
                                            scope: 'public_profile,email,ads_management,manage_pages'
                                        })
                                };

                            </script>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <nav class="c-pagination u-justify-center">
        {% if pagination %}
            {{ pagination.links }}
        {% endif %}
    </nav>
    <!-- <script src="{{ url_for('static', filename='nextify/js/advertising.js') }}"></script> -->
    <input type="hidden" value="{{ post_engagement_total }}" id="post_engagement_total">
    <input type="hidden" value="{{ impressions }}" id="impressions">
    <input type="hidden" value="{{ clicks }}" id="clicks_total">
    <input type="hidden" value="{{ data_chart }}" id="data_chart">
</div>
</div>

{% endblock %}
{% block js %}
<script src="{{ url_for('static', filename='nextify/js/daterangepicker.js') }}"></script>
<script src="{{ url_for('static', filename='nextify/js/advertising.js') }}"></script>
{% endblock %}