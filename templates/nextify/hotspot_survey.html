{% extends 'nextify/manage_hotspot.html' %}

{% block hotspot_item %}
<input type="hidden" value="{{ shop_id_select }}" id="shop_id_select" />
<input type="hidden" name="list_id_survey" id="list_id_survey" value="{{ list_id_survey }}" />
<input type="hidden" name="merchant_id" id="merchant_id" value="{{ merchant_id }}" />
<input type="hidden" name="dealer_id" id="dealer_id" value="{{ dealer_id }}" />
<div class="row justify-content-center">
    <div class="col-12 col-lg-12 col-xl-12">
        <div class="card">
            <div class="card-header">
                <div class="row align-items-end">
                    <div class="col">

                        <h6 class="header-pretitle">
                            {{gettext('HotspotSurveyScreenText')}}
                        </h6>
                    </div>
                    <div class="col-auto" style="float: right">
                        <a href="#new_tag_modal" data-toggle="modal" style="margin-left: 470px">
                            <i class="fe fe-plus"></i> {{ gettext('Tao_tag_nhanh') }}
                        </a>
                        <input type="hidden" name="status" id="status" value="{{ status }}" />
                        {% if status == 'true' and pages.count() > 0 %}
                        <a id="deactive_splash" href="/deactive_splash/{{ shop_id_select }}/survey?status=true"
                            style="color: red">
                            <i class="fa fa-ban"></i> {{ gettext('Ngung_hoat_dong_tat_ca_trang_chao') }}
                        </a>
                        {% elif status == 'false' and pages.count() > 0 %}
                        <a id="deactive_splash" href="/deactive_splash/{{ shop_id_select }}/survey?status=false"
                            style="color: green">
                            <i class="fa fa-check"></i> {{ gettext('Hoat_dong_tat_ca_trang_chao') }}
                        </a>
                        {% endif %}
                        <a data-toggle="modal" href="#new_page_loyal" class="btn btn-flat d-block d-md-inline-block">
                            <i class="fa fa-plus"></i> {{gettext('HotspotSurveyScreenAddText')}}
                        </a>

                    </div>
                </div>

            </div>
            {% if pages.count() > 0 %}
            <div class="table-responsive">
                <table class="table table-sm card-table">
                    <thead>
                        <tr>
                            <th>

                            </th>

                            <th>

                            </th>
                            <th>

                            </th>
                            <th>

                            </th>


                        </tr>
                    </thead>
                    <tbody>
                        {% for page in pages %}
                        <tr>
                            <td>

                                {% if page.survey_type == 'multi_select' %}
                                {{gettext('HotspotSurveyScreenMultipleText')}}
                                {% elif page.survey_type == 'one_select' %}
                                {{gettext('HotspotSurveyScreenSingleText')}}
                                {% elif page.survey_type == 'rating' %}
                                {{gettext('HotspotSurveyScreenRateText')}}
                                {% elif page.survey_type == 'comment' %}
                                {{gettext('HotspotSurveyScreenMultipleText')}}
                                {% endif %}

                            </td>
                            <td>
                                {% if page.active %}
                                <a href="/wifi/{{ shop_id_select }}/survey/{{ page._id }}/active">
                                    <span
                                        class="badge badge-soft-success">{{gettext('HotspotNumberofvisitsScreenActiveText')}}</span>
                                </a>
                                {% else %}
                                <a href="/wifi/{{ shop_id_select }}/survey/{{ page._id }}/active">
                                    <span
                                        class="badge badge-soft-secondary">{{gettext('HotspotNumberofvisitsScreenPendingText')}}</span>
                                </a>
                                {% endif %}
                            </td>
                            <td>

                                <input class="form-control"
                                    value="{%if page.bitly_url and page.bitly_url|length > 0%}{{page.bitly_url.url}} {%else%}{{ request.host_url}}survey/{{ shop_select._id }}/{{page._id}}{%endif%}"
                                    readonly>


                            </td>
                            <td>

                                <a href="#" id="result_{{ page._id }}"
                                    url="/surveys_reports/{{ shop_id_select }}/view/{{ page._id }}"
                                    class="btn btn-dark "><i class="fe fe-activity"></i>
                                    {{gettext('HotspotSurveyScreenResultText')}}</a>
                                <script nonce="{{ csp_nonce() }}">
                                    $(document).ready(function () {
                                        $('#result_{{ page._id }}').click(function () {
                                            var url = $(this).attr("url");

                                            $.ajax({
                                                url: url,
                                                success: function (res) {
                                                    $('#modal_result_{{ page._id }} .modal-body').html(res);
                                                    $('#modal_result_{{ page._id }}').modal('show');

                                                },
                                                error: function (request, status, error) {
                                                    console.log("ajax call went wrong:" + request.responseText);
                                                }
                                            });
                                        });
                                    })
                                </script>
                                <div class="modal hide fade" id="modal_result_{{ page._id }}" tabindex="-1" role="dialog"
                                    aria-labelledby="new_image" data-backdrop="static" style="display: none;"
                                    aria-hidden="true">
                                    <div class="modal-dialog" role="document">
                                        <div class="modal-content">
                                            <div class="modal-header">
                                                <h3 class="modal-title">{{gettext('HotspotSurveyScreenResultText')}}
                                                </h3>

                                                <a class="close" data-dismiss="modal" aria-label="Close">
                                                    <span aria-hidden="true">×</span>
                                                </a>
                                            </div>
                                            <div class="modal-body">

                                            </div>
                                        </div>
                                    </div>
                                </div>

                                {% if dealer_id == "5de0db6306e7eca17bd8e872" %}
                                <a href="/surveys_comment/{{ shop_id_select }}/view/{{ page._id }}"
                                    class="btn btn-dark "><i class="fa fa-commenting-o"></i>
                                    Nhận xét</a>
                                {% endif %}
                                {% if dealer_id != "5de0db6306e7eca17bd8e872" %}
                                <a href="/surveys_reports/{{ shop_id_select }}/results/{{ page._id }}"
                                    class="btn btn-dark "><i class="fa fa-tag"></i>
                                    {{gettext('HotspotSurveyScreenDetailText')}}</a>
                                {% endif %}

                                <a href="#view_{{ page._id }}" data-toggle="modal" class="btn btn-dark">
                                    <i class="fa fa-mobile"></i> {{gettext('HotspotSurveyScreenReviewText')}}</a>
                                <div class="modal hide fade" id="view_{{ page._id }}" tabindex="-1" role="dialog"
                                    aria-labelledby="new_image" data-backdrop="static" style="display: none;"
                                    aria-hidden="true">
                                    <div class="modal-dialog" role="document">
                                        <div class="modal-content">
                                            <div class="modal-header">
                                                <h3 class="modal-title">{{gettext('HotspotSurveyScreenReviewText')}}
                                                </h3>

                                                <a class="close" data-dismiss="modal" aria-label="Close">
                                                    <span aria-hidden="true">×</span>
                                                </a>
                                            </div>
                                            <div class="modal-body">
                                                <div id="preview_{{ page._id }}"></div>
                                                <script nonce="{{ csp_nonce() }}">

                                                    $(document).ready(function () {
                                                        var url_preview = '/wifi/{{shop_id_select}}' + '/survey/' + '{{ page._id }}/preview';
                                                        $("#preview_{{ page._id }}").empty();
                                                        console.log(url_preview);
                                                        bioMp(document.getElementById('preview_{{ page._id }}'), {
                                                            url: url_preview,
                                                            view: 'front',
                                                            image: '/static/images/iphone_simulator/img_preview_mobile.svg',
                                                            height: 618,
                                                            width: 308
                                                        });
                                                    })

                                                </script>
                                            </div>
                                        </div>
                                    </div>
                                </div>





                                <a id="remove_{{ page._id }}" href="#" class="btn btn-dark ">
                                    <i class="fa fa-remove"></i> {{gettext('HotspotSurveyScreenDeleteText')}}</a>
                                <script nonce="{{ csp_nonce() }}">
                                    $(document).ready(function () {
                                        $('#remove_{{ page._id }}').click(function () {
                                            var url = "/wifi/{{ shop_id_select }}/survey/{{ page._id }}/remove";
                                            Swal.fire({
                                                title: '{{ gettext("Ban_co_chac_chan_muon_trang_chao_khong?") }}',

                                                type: 'warning',
                                                showCancelButton: true,
                                                confirmButtonColor: '#3085d6',
focusCancel: true,
                                                cancelButtonColor: '#d33',
                                                confirmButtonText: 'Có!',
                                                cancelButtonText: '{{ gettext("Khong!")}}'
                                            }).then((result) => {
                                                if (result.value) {
                                                    $.ajax({
                                                        type: 'get',
                                                        url: url,
                                                        success: function () {
                                                            swal("{{ gettext('Thao_tac_thanh_cong') }}", " ", "success");
                                                            location.reload();
                                                        }
                                                    });


                                                }
                                            })
                                        });;


                                    })
                                </script>
                            </td>

                        </tr>





                        {% endfor %}

                    </tbody>
                </table>
            </div>
            <nav class="c-pagination u-justify-center">
                {% if pagination %}
                {{ pagination.links }}
                {% endif %}
            </nav>
        </div>



    </div>

</div>

{% else %}

<div class="card-body">
    <div class="row justify-content-center">
        <div class="col-12 col-md-10 col-xl-8 justify-content-center"
            style="text-align: center;margin-bottom: 30px; margin-top: 30px">
            <!-- Image -->
            <img src="/static/nextify/img/happiness.png" alt="..." class="img-fluid mt-n5 mb-4"
                style="max-width: 272px;">
            <!-- Title -->
            <h2>
                {{ gettext('Ban_chua_tao') }} {{gettext('HotspotSurveyScreenText')}}. {{ gettext('Vui_long_them_loai') }}
                {{gettext('HotspotSurveyScreenText')}}.
            </h2>
            <a data-toggle="modal" href="#new_page_loyal" class="btn btn-flat d-block d-md-inline-block">
                <i class="fa fa-plus"></i> {{gettext('HotspotSurveyScreenAddText')}}
            </a>

        </div>

    </div>


</div>

{% endif %}




<div class="modal hide fade" id="new_page_loyal" tabindex="-1" role="dialog" aria-labelledby="new_page_loyal"
    data-backdrop="static" style="display: none;" aria-hidden="true">
    <div class="modal-dialog" role="document" style="max-width: 700px">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">{{gettext('HotspotSurveyScreenAddText')}}</h3>

                <a class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">×</span>
                </a>
            </div>
            <form method="POST" action="/wifi/{{ shop_id_select }}/new_hotspot/survey" enctype="multipart/form-data"
                id="form_new_survey">
                <input type="hidden" name="_csrf_token" value="{{ csrf_token() }}" />


                <div class="modal-body">


                    {% if error %}
                    <div class="alert alert-danger alert-dismissible fade show" role="alert">
                        <strong style="color: #fff;">{{ error }}</strong>
                    </div>
                    {% endif %}

                    <div class="row">
                              <div class="col-sm-12 col-md-6 u-mb-medium">
                                  <div class="form-group">
                                      <label for="hotspot_method">{{ gettext('Hinh_thuc_hotspot') }}</label>
                                      <select class="form-control" id="hotspot_method"
                                          name="hotspot_method">
                                          <option value="default">{{ gettext('Mac_dinh') }}</option>
                                          <option value="profile_code">Profile code</option>
                                      </select>
                                  </div>
                              </div>
                              <div id="default_code_div" class="col-sm-12 col-md-6 u-mb-medium">
                                  <div class="form-group">
                                      <label>{{ gettext('Ma_mac_dinh') }}Mã mặc định</label><span class="c-badge c-badge--info c-tooltip c-tooltip--top"
                                       aria-label="{{ gettext('Ma_truy_cap_Wifi_mac_dinh') }}">
                                     <i class="fa fa-question"></i>
                                 </span>
                                      <input type="text" class="form-control method-form-control" id="default_code" name="default_code">
                                  </div>
                              </div>
                            </div>
                    <div class="form-group">
                        <label for="photo">{{gettext('HotspotSurveyScreenPictureText')}}:</label>
                        <p class="help-block">
                            <img id="img_new_photo" width="200">
                        </p>

                        <input type="file" class="form-control" id="new_photo" name="photo">
                    </div>

                    <script nonce="{{ csp_nonce() }}">
                        $(document).ready(function () {
                            function readURL(input, input_view) {
                                if (input.files && input.files[0]) {
                                    var reader = new FileReader();
                                    var view_id = '#' + input_view;
                                    reader.onload = function (e) {
                                        $(view_id).attr('src', e.target.result);
                                    }

                                    reader.readAsDataURL(input.files[0]);
                                }
                            }

                            function validate(photo) {
                                var file_size = $(photo)[0].files[0].size;
                                var file = $(photo).val();
                                var exts = ['jpg', 'png', 'jpeg'];
                                if (file) {
                                    var get_ext = file.split('.');
                                    get_ext = get_ext.reverse();
                                    if ($.inArray(get_ext[0].toLowerCase(), exts) > -1) {
                                        if (file_size > 3670016) {
                                            return "big_file";
                                        } else {
                                            return true;
                                        }
                                    } else {
                                        return false;
                                    }
                                }

                            }

                            $("#new_photo").change(function () {
                                var validate_photo = validate(this);
                                if (validate_photo == true) {
                                    swal('{{ gettext("Upload_thanh_cong") }}', '', 'success');
                                    $('#img_new_photo').show();
                                    readURL(this, 'img_new_photo');
                                } else {
                                    if (validate_photo == "big_file"){
                                        swal('{{ gettext("File_co_kich_thuoc_qua_lon!") }}', '', 'error');
                                        return false
                                    };
                                    swal('{{ gettext("File_khong_dung_dinh_dang") }}', '', 'error');
                                    $('#new_photo').val('');
                                    $('#img_new_photo').hide();

                                }
                            });
                        })
                    </script>

                    <div class="row align-items-end" style="padding-top: 10px; padding-bottom: 10px">
                        <div class="col-12">
                            <label>
                                Loại khảo sát
                            </label>
                            {% if dealer_id == "5de0db6306e7eca17bd8e872" %}
                            <select class="form-control" id="survey_type" name="survey_type">
                                <option value="rating">{{gettext('HotspotSurveyScreenRateText')}}</option>
                            </select>
                            {% else %}
                            <select class="form-control" id="survey_type" name="survey_type">
                                <option value="multi_select"> {{gettext('HotspotSurveyScreenMultipleText')}}</option>
                                <option value="one_select"> {{gettext('HotspotSurveyScreenSingleText')}}</option>
                                <option value="rating">{{gettext('HotspotSurveyScreenRateText')}}</option>
                            </select>
                            {% endif %}
                        </div>
                    </div>
                    {% if dealer_id == "5de0db6306e7eca17bd8e872" %}
                    <div class="row align-items-end" style="padding-top: 10px; padding-bottom: 10px">
                        <div class="col-12">

                            <!-- Pretitle -->
                            <label>
                                {{ gettext('Cau_hoi_1') }}
                            </label>

                            <input type="text" class="form-control" id="question_1" name="question_1"
                                placeholder="{{ gettext('Tong_dai_va_dich_vu_tra_loi_truoc_khi_len_xe?') }}" />

                        </div>
                    </div>
                    <div class="row align-items-end" style="padding-top: 10px; padding-bottom: 10px">
                        <div class="col-12">

                            <!-- Pretitle -->
                            <label>
                                {{ gettext('Cau_hoi_2') }}
                            </label>

                            <input type="text" class="form-control" id="question_2" name="question_2"
                                placeholder="{{ gettext('Thai_do_va_cach_phuc_vu_cua_tai_xe_va_tiep_vien') }}" />

                        </div>
                    </div>
                    <div class="row align-items-end" style="padding-top: 10px; padding-bottom: 10px">
                        <div class="col-12">

                            <!-- Pretitle -->
                            <label>
                                {{ gettext('Cau_hoi_3') }}
                            </label>

                            <input type="text" class="form-control" id="question_3" name="question_3"
                                placeholder="{{ gettext('Chat_luong_phuong_tien_van_chuyen') }}" />

                        </div>
                    </div>
                    <div class="row align-items-end" style="padding-top: 10px; padding-bottom: 10px">
                        <div class="col-12" id="rating_anvui">
                            <div class="c-field u-mb-small">
                                <div class="row">
                                    <div class="col-lg-6">
                                        <label>{{ gettext('Diem_tu:') }} </label>
                                        <input type="text" class="c-input" value="" id="min_point" name="min_point"
                                            placeholder="1" />
                                    </div>
                                    <div class="col-lg-6">
                                        <label>{{ gettext('den:') }} </label>
                                        <input type="text" class="c-input" value="" id="max_point" name="max_point"
                                            placeholder="10" />
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row align-items-end" style="padding-top: 10px; padding-bottom: 10px">
                        <div class="col-12">

                            <!-- Pretitle -->
                            <label>
                                {{ gettext('Tieu_de') }}
                            </label>

                            <input type="text" class="form-control" id="title_anvui" name="title_anvui"
                                placeholder="{{gettext('HotspotSurveyScreenPlaceholderText')}}"
                                value="{{ shop_select.welcome_member_text_splash or "{{ gettext('CAM_ON_BAN') }}" + ' {{ name }}' }}" />


                        </div>
                    </div>
                    <div class="row align-items-end" style="padding-top: 10px; padding-bottom: 10px">
                        <div class="col-12">

                            <!-- Pretitle -->
                            <label>
                                {{ gettext('Noi_dung') }}
                            </label>

                            <textarea class="form-control" id="content_anvui" name="content_anvui" rows="3"
                                value="{{ shop_select.welcome_member_text_splash or "{{ gettext('Da_tin_tuong_su_dung_dich_vu_cua_Nha_Xe') }}" + ' {{ shop_name }}' "{{ gettext('Vui_long_cho_chung_tai_xin_nhan_xet_danh_gia_cua_ban_ve_dich_vu_va_chat_luong_cua_nha_xe_de_co_the_phuc_vu_ban_tot_hon_trong_tuong_lai.') }}" }}">{{ gettext('Da_tin_tuong_su_dung_dich_vu_cua_Nha_Xe') }} {{ shop_name }} {{ gettext('Vui_long_cho_chung_tai_xin_nhan_xet_danh_gia_cua_ban_ve_dich_vu_va_chat_luong_cua_nha_xe_de_co_the_phuc_vu_ban_tot_hon_trong_tuong_lai.') }}
                                </textarea>

                        </div>
                    </div>
                    <div class="row align-items-end" style="padding-top: 10px; padding-bottom: 10px">
                        <div class="col-12">
                            <div class="c-field u-mb-small">
                                <label for="auto_popup">{{gettext('HotspotSurveyScreenRedirectText')}}:</label>
                                <input type="text" class="c-input" id="auto_popup" name="auto_popup" placeholder="">
                            </div>
                        </div>
                    </div>
                    <div class="row align-items-end" style="padding-top: 10px; padding-bottom: 10px">
                        <div class="col-12">
                            <div class="c-field u-mb-small">
                                <div class="c-field u-mb-small">
                                    <label>{{gettext('HotspotSurveyScreenActiveText')}}</label>
                                    <input type="checkbox" name="active" id="active" class="c-input">
                                </div>

                            </div>
                        </div>
                    </div>
                    {% else %}
                    <div class="row align-items-end" style="padding-top: 10px; padding-bottom: 10px">
                        <div class="col-12">

                            <!-- Pretitle -->
                            <label>
                                {{gettext('HotspotSurveyScreenQuestionText')}}
                            </label>

                            <input type="text" class="form-control" id="question" name="question"
                                placeholder="{{gettext('HotspotSurveyScreenPlaceholderText')}}" />

                        </div>
                    </div>


                    <div class="row align-items-end" style="padding-top: 10px; padding-bottom: 10px">

                        <div class="col-12" id="multi_select">
                            <div class="c-field u-mb-small">

                                <label>
                                    {{gettext('HotspotSurveyScreenResultText')}}
                                </label>


                            </div>
                            <div id="an_multi_select">
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="c-field u-mb-small">
                                            <input type="text" placeholder="{{ gettext('Noi_dung') }}" class="form-control" />
                                        </div>

                                    </div>
                                    <div class="col-md-6">
                                        <div class="c-field u-mb-small">
                                            <select class="form-control">
                                                {% for tag in tags %}
                                                <option id="{{ tag._id }}" value="{{ tag._id }}">{{ tag.name }}
                                                </option>
                                                {% endfor %}
                                            </select>
                                        </div>

                                    </div>

                                </div>


                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="c-field u-mb-small">
                                            <input type="text" placeholder="{{ gettext('Noi_dung') }}" class="form-control" />
                                        </div>

                                    </div>
                                    <div class="col-md-6">
                                        <div class="c-field u-mb-small">
                                            <select class="form-control">
                                                {% for tag in tags %}
                                                <option id="{{ tag._id }}" value="{{ tag._id }}">{{ tag.name }}
                                                </option>
                                                {% endfor %}
                                            </select>
                                        </div>

                                    </div>

                                </div>
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="c-field u-mb-small">
                                            <input type="text" placeholder="{{ gettext('Noi_dung') }}" class="form-control" />
                                        </div>

                                    </div>
                                    <div class="col-md-6">
                                        <div class="c-field u-mb-small">
                                            <select class="form-control">
                                                {% for tag in tags %}
                                                <option id="{{ tag._id }}" value="{{ tag._id }}">{{ tag.name }}
                                                </option>
                                                {% endfor %}
                                            </select>
                                        </div>

                                    </div>

                                </div>
                                <!-- <script nonce="{{ csp_nonce() }}">
                                    $(document).ready(function () {
                                        var length_select = $("#an_multi_select").children('div.row').length;
                                        var url = window.location.href + "/get_list_tags";
                                        $('#1').select2({
                                            dropdownParent: $("#new_page_loyal")
                                        })
                                        $.ajax({
                                            type: 'GET',
                                            url: url,
                                            dataType: "json",
                                            success: function (result) {
                                                $('#1').select2({
                                                    data: result,
                                                    dropdownParent: $("#new_page_loyal")
                                                })
                                            }
                                        });
                                        $('#2').select2({
                                            dropdownParent: $("#new_page_loyal")
                                        })
                                        $.ajax({
                                            type: 'GET',
                                            url: url,
                                            dataType: "json",
                                            success: function (result) {
                                                $('#2').select2({
                                                    data: result,
                                                    dropdownParent: $("#new_page_loyal")
                                                })
                                            }
                                        });
                                        $('#3').select2({
                                            dropdownParent: $("#new_page_loyal")
                                        })
                                        $.ajax({
                                            type: 'GET',
                                            url: url,
                                            dataType: "json",
                                            success: function (result) {
                                                $('#3').select2({
                                                    data: result,
                                                    dropdownParent: $("#new_page_loyal")
                                                })
                                            }
                                        });
                                    })
                                </script> -->
                            </div>

                            <div class="c-field u-mb-small">
                                <a id="new_result_multi" class="c-btn c-btn--info u-float-right">
                                    {{gettext('HotspotSurveyScreenResultText')}}
                                </a>
                            </div>


                        </div>
                        <div class="col-12" id="one_select">
                            <div class="c-field u-mb-small">
                                <label>
                                    {{gettext('HotspotSurveyScreenResultText')}}
                                </label>

                            </div>
                            <div id="an_one_select">
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="c-field u-mb-small">
                                            <input type="text" placeholder="{{ gettext('Noi_dung') }}" class="form-control" />
                                        </div>

                                    </div>
                                    <div class="col-md-6">
                                        <div class="c-field u-mb-small">
                                            <select class="form-control">
                                                {% for tag in tags %}
                                                <option id="{{ tag._id }}" value="{{ tag._id }}">{{ tag.name }}
                                                </option>
                                                {% endfor %}
                                            </select>
                                        </div>

                                    </div>

                                </div>
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="c-field u-mb-small">
                                            <input type="text" placeholder="{{ gettext('Noi_dung') }}" class="form-control" />
                                        </div>

                                    </div>
                                    <div class="col-md-6">
                                        <div class="c-field u-mb-small">
                                            <select class="form-control">
                                                {% for tag in tags %}
                                                <option id="{{ tag._id }}" value="{{ tag._id }}">{{ tag.name }}
                                                </option>
                                                {% endfor %}
                                            </select>
                                        </div>

                                    </div>

                                </div>
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="c-field u-mb-small">
                                            <input type="text" placeholder="{{ gettext('Noi_dung') }}" class="form-control" />
                                        </div>

                                    </div>
                                    <div class="col-md-6">
                                        <div class="c-field u-mb-small">
                                            <select class="form-control">
                                                {% for tag in tags %}
                                                <option id="{{ tag._id }}" value="{{ tag._id }}">{{ tag.name }}
                                                </option>
                                                {% endfor %}
                                            </select>
                                        </div>

                                    </div>

                                </div>
                                <!-- <script nonce="{{ csp_nonce() }}">
                                    $(document).ready(function () {
                                        var length_select = $("#an_one_select").children('div.row').length;
                                        var url = window.location.href + "/get_list_tags";
                                        $('#one1').select2({
                                            dropdownParent: $("#new_page_loyal")
                                        })
                                        $.ajax({
                                            type: 'GET',
                                            url: url,
                                            dataType: "json",
                                            success: function (result) {

                                                $('#one1').select2({
                                                    data: result,
                                                    dropdownParent: $("#new_page_loyal")
                                                })
                                            }
                                        });
                                        $('#one2').select2({
                                            dropdownParent: $("#new_page_loyal")
                                        })
                                        $.ajax({
                                            type: 'GET',
                                            url: url,
                                            dataType: "json",
                                            success: function (result) {

                                                $('#one2').select2({
                                                    data: result,
                                                    dropdownParent: $("#new_page_loyal")
                                                })
                                            }
                                        });
                                        $('#one3').select2({
                                            dropdownParent: $("#new_page_loyal")
                                        })
                                        $.ajax({
                                            type: 'GET',
                                            url: url,
                                            dataType: "json",
                                            success: function (result) {

                                                $('#one3').select2({
                                                    data: result,
                                                    dropdownParent: $("#new_page_loyal")
                                                })
                                            }
                                        });
                                    })

                                </script> -->
                            </div>
                            <div class="c-field u-mb-small">
                                <a id="new_result_single" class="c-btn c-btn--info u-float-right" href="#">
                                    {{gettext('HotspotSurveyScreenResultText')}}
                                </a>
                            </div>

                        </div>
                        <div class="col-12" id="rating">

                            <div class="c-field u-mb-small">
                                <div class="row">
                                    <div class="col-lg-6">
                                        <label>Điểm từ: </label>
                                        <input type="text" class="c-input" value="" id="min_point" name="min_point"
                                            placeholder="1" />
                                    </div>
                                    <div class="col-lg-6">
                                        <label>đến: </label>
                                        <input type="text" class="c-input" value="" id="max_point" name="max_point"
                                            placeholder="10" />
                                    </div>

                                </div>

                            </div>


                        </div>
                        <div class="col-12">
                            <div class="c-field u-mb-small">
                                <label for="auto_popup">{{gettext('HotspotSurveyScreenRedirectText')}}:</label>
                                <input type="text" class="c-input" id="auto_popup" name="auto_popup" placeholder="">
                            </div>
                        </div>
                        <div class="col-12">
                            <div class="c-field u-mb-small">
                                <div class="c-field u-mb-small">
                                    <label>{{gettext('HotspotSurveyScreenActiveText')}}</label>
                                    <input type="checkbox" name="active" id="active" class="c-input">
                                </div>

                            </div>
                        </div>


                    </div>
                    {% endif %}
                    <div class="modal-footer">
                        <button type="submit" class="c-btn c-btn--info u-float-right">
                            {{gettext('HotspotUpdateText')}}
                        </button>
                    </div>
                </div>


            </form>


        </div><!-- // .c-modal__content -->
    </div><!-- // .c-modal__dialog -->
</div>
<div class="modal hide fade" id="new_tag_modal" tabindex="-1" role="dialog" aria-labelledby="userDetailModal"
    data-backdrop="static" data-focus-on="input:first">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-card card">
                <div class="card-header">
                    <div class="row align-items-center">
                        <div class="col">
                            <!-- Title -->
                            <h4 class="card-header-title" id="exampleModalCenterTitle">
                                {{ gettext('Them_moi_Tag') }}
                            </h4>

                        </div>
                        <div class="col-auto">

                            <!-- Close -->
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">×</span>
                            </button>

                        </div>
                    </div>
                </div>
                <div class="card-body">

                    <div class="col-lg-12">
                        <div class="row u-mb-medium">
                            <div class="col-lg-12">
                                <form method="POST" action="/create_tags/add" role="form" id="new_tag_fr">
                                    <input type="hidden" name="_csrf_token" value="{{ csrf_token() }}" />
                                    <div class="form-group">
                                        <label for="name">{{ gettext('Ten:') }} (<span>
                                                <font color="red">*</font>
                                            </span> {{ gettext('bat_buoc') }}</label>
                                        <input type="tel" class="form-control" id="name" name="name_add_new_tag"
                                            placeholder="{{ gettext('Loai_Tag') }}" />
                                    </div>
                                    <div class="form-group">
                                        <label for="textarea2">{{ gettext('Mo_ta:') }} <span>
                                                <font color="red">*</font>
                                            </span>{{ gettext('bat_buoc') }}</label>
                                        <textarea class="form-control" id="desc" name="desc"
                                            placeholder="{{ gettext('Mo_ta') }}"></textarea>
                                    </div>
                                    <input type="hidden" name="shop_id_select" value="{{ shop_id_select }}"
                                        id="shop_id_select" />
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="form-group" style="text-align: center">

                    <button id="new_tag_btn" class="btn btn-primary">{{ gettext('Them_moi') }}</button>
                </div>

            </div>
        </div>
    </div>
</div>
{% endblock %}
{% block js %}

<script nonce="{{ csp_nonce() }}">
    $(document).ready(function () {
        $('#hotspot_method').select2();
            $('#hotspot_method').on('change.select2', function (e) {
                method = $(this).val();
                if (method === 'profile_code') {
                    $("#default_code_div").hide();
                } else {
                    $("#default_code_div").show();
                }
            });
        $.fn.modal.Constructor.prototype.enforceFocus = function () { };
        $("#new_tag_btn").click(function () {
            var name = $("#name").val();
            var desc = $("#desc").val();

            if (name.length == 0) {
                swal("{{ gettext('Ten_Tag_khong_duoc_de_trong') }}", " ", "error");
                return false;

            }
            if (desc.length == 0) {
                swal("{{ gettext('Mo_ta_khong_duoc_de_trong') }}", " ", "error");
                return false;

            }
            $.ajax({
                url: '/test_ajax_create_tag',
                type: $("#new_tag_fr").attr("method"),
                data: $("#new_tag_fr").serialize(),

                success: function (response) {
                    var returnedData = JSON.parse(response);
                    if ('error' in returnedData) {

                        swal(returnedData['error'], " ", "error");
                    }
                    else {
                        swal('{{ gettext("Them_moi_tag_thanh_cong") }}', '', 'success');
                        $("#new_tags_selects").select2({
                            'data': returnedData
                        })
                    }
                },
                error: function (xhr, desc, err) {
                    swal("{{ gettext('Co_loi_xay_ra,_thu_lai_sau') }}", " ", "error");


                }
            })
        }
        )

        $("#deactive_splash").click(function () {
            swal("{{ gettext('Thao_tac_thanh_cong') }}", '', 'success');
        })
        $('textarea').each(function () {
            $(this).val($(this).val().trim());
        }
        );
        $('input').each(function () {
            $(this).val($(this).val().trim());
        }
        );
        var shop_id_select = $("#shop_id_select").val();
        $("#multi_select").show();
        $("#one_select").hide();
        $("#rating").hide();

        $('#survey_type').on("change", function (e) {
            var survey_type = $('#survey_type').val();
            if (survey_type == 'multi_select') {
                $("#multi_select").show();
                $("#one_select").hide();
                $("#rating").hide();

            } else if (survey_type == 'one_select') {
                $("#multi_select").hide();
                $("#one_select").show();
                $("#rating").hide();

            } else if (survey_type == 'rating') {
                $("#multi_select").hide();
                $("#one_select").hide();
                $("#rating").show();


            } else if (survey_type == 'comment') {
                $("#multi_select").hide();
                $("#one_select").hide();
                $("#rating").hide();

            }

        });
        $("#new_result_multi").click(function () {
            $("#an_multi_select").append('<div class="row">\n' +
                ' <div class="col-md-6">\n' +
                '    <div class="c-field u-mb-small">\n' +
                '  <input type="text" placeholder=' + '{{ gettext("Noi_dung") }}' + ' class="form-control"/>\n' +
                '</div>\n' +

                '  </div>\n' +
                '<div class="col-md-6">\n' +
                '<div class="c-field u-mb-small">\n' +
                '<select placeholder="Tag" class="form-control">\n' +
                '{% for tag in tags %}\n' +
                '<option id="{{ tag._id }}" value="{{ tag._id }}">{{ tag.name }}</option>\n' +
                '{% endfor %}</select>\n' +

                '  </div>\n' +

                ' </div>\n' +
                ' </div>');
        });
        $("#new_result_single").click(function () {
            $("#an_one_select").append('<div class="row">\n' +
                ' <div class="col-md-6">\n' +
                '    <div class="c-field u-mb-small">\n' +
                '  <input type="text" placeholder=' + '{{ gettext("Noi_dung") }}' + ' class="form-control"/>\n' +
                '</div>\n' +

                '  </div>\n' +
                '<div class="col-md-6">\n' +
                '<div class="c-field u-mb-small">\n' +
                '<select placeholder="Tag" class="form-control">\n' +
                '{% for tag in tags %}\n' +
                '<option id="{{ tag._id }}" value="{{ tag._id }}">{{ tag.name }}</option>\n' +
                '{% endfor %}</select>\n' +

                '  </div>\n' +

                ' </div>\n' +
                ' </div>');
        });



        // $("#new_result_multi").click(function () {
        //     var length_select = $("#an_multi_select").children('div.row').length;
        //     var length_select1 = length_select + 1;

        //     $("#an_multi_select").append('<div class="row">\n' +
        //         ' <div class="col-md-6">\n' +
        //         '    <div class="c-field u-mb-small">\n' +
        //         '  <input type="text" placeholder="Nội dung" class="form-control"/>\n' +
        //         '</div>\n' +

        //         '  </div>\n' +
        //         '<div class="col-md-6">\n' +
        //         '<div class="c-field u-mb-small">\n' +
        //         '<select id="' + length_select1.toString() + '" class="form-control">\n' +
        //         '</select>\n' +

        //         '  </div>\n' +

        //         ' </div>\n' +
        //         ' </div>\n' +
        //         '<script nonce="{{ csp_nonce() }}">\n' +
        //         '$(document).ready(function () {\n' + 'var url = window.location.href + "/get_list_tags";\n' +
        //         '$(' + '"#' + length_select1.toString() + '").select2({\n' +

        //         'dropdownParent: $("#new_page_loyal")})\n' +

        //         '$.ajax({\n' +
        //         'type: "GET",\n' +
        //         'url: url,\n' +
        //         'dataType: "json",\n' +
        //         'success: function (result) {\n' +

        //         '$(' + '"#' + length_select1.toString() + '").select2({\n' +
        //         'data: result,\n' +
        //         'dropdownParent: $("#new_page_loyal")\n' +
        //         '})}})});\n' +
        //         '</' + 'script>'


        //     );
        // });
        // $("#new_result_single").click(function () {
        //     var length_select = $("#an_one_select").children('div.row').length;
        //     var length_select1 = length_select + 1;

        //     $("#an_one_select").append('<div class="row">\n' +
        //         ' <div class="col-md-6">\n' +
        //         '    <div class="c-field u-mb-small">\n' +
        //         '  <input type="text" placeholder="Nội dung" class="form-control"/>\n' +
        //         '</div>\n' +

        //         '  </div>\n' +
        //         '<div class="col-md-6">\n' +
        //         '<div class="c-field u-mb-small">\n' +
        //         '<select id="one' + length_select1.toString() + '" class="form-control">\n' +
        //         '</select>\n' +

        //         '  </div>\n' +

        //         ' </div>\n' +
        //         ' </div>\n' +
        //         '<script nonce="{{ csp_nonce() }}">\n' +
        //         '$(document).ready(function () {\n' + 'var url = window.location.href + "/get_list_tags";\n' +
        //         '$(' + '"#one' + length_select1.toString() + '").select2({\n' +

        //         'dropdownParent: $("#new_page_loyal")})\n' +

        //         '$.ajax({\n' +
        //         'type: "GET",\n' +
        //         'url: url,\n' +
        //         'dataType: "json",\n' +
        //         'success: function (result) {\n' +

        //         '$(' + '"#one' + length_select1.toString() + '").select2({\n' +
        //         'data: result,\n' +
        //         'dropdownParent: $("#new_page_loyal")\n' +
        //         '})}})});\n' +
        //         '</' + 'script>'


        //     );
        // });

        $("#form_new_survey").on('submit', (function (e) {
            e.preventDefault();
            var survey_type = $("#survey_type").val();
            var answers = [];
            var question = $("#question").val();
            var merchant_id = $("#merchant_id").val();
            var dealer_id = $("#dealer_id").val();
            if (survey_type == '0') {

                swal("{{ gettext('Ban_chua_chon_loai_khao_sat') }}", " ", "error");
                return false;
            };
            if (dealer_id != '5de0db6306e7eca17bd8e872') {
                if (question.length == '0') {
                    swal("{{ gettext('Ban_chua_nhap') }} {{gettext('HotspotSurveyScreenQuestionText')}}", " ", "error");
                    return false;
                }
            };
            if (survey_type == 'multi_select') {
                $("#an_multi_select").children('div.row').each(function (i) {
                    var item = [];
                    $(this).find(':input').each(function () {
                        item.push($(this).val());
                    });
                    var name_ranks = item[0];
                    var points_ranks = item[1];
                    if (name_ranks.length > 0) {
                        var item_array = { 'id': i, 'value': name_ranks, 'tag': points_ranks };
                        answers.push(item_array);
                    }

                });

            }

            if (survey_type == 'one_select') {
                $("#an_one_select").children('div.row').each(function (i) {
                    var item = [];
                    $(this).find(':input').each(function (e) {

                        item.push($(this).val());
                    });
                    var name_ranks = item[0];
                    var points_ranks = item[1];
                    if (name_ranks.length > 0) {
                        var item_array = { 'id': i, 'value': name_ranks, 'tag': points_ranks };
                        answers.push(item_array);
                    }
                });

            }
            if (survey_type == 'rating') {

                if ($("#max_point").val().length == 0) {
                    swal("{{ gettext('Ban_chua_nhap_thang_diem') }}", " ", "error");
                    return false;

                }
                if ($("#min_point").val().length == 0) {
                    swal("{{ gettext('Ban_chua_nhap_thang_diem') }}", " ", "error");
                    return false;

                }

            }
            var answers_json = JSON.stringify(answers);
            var active = $("#active").is(":checked");
            var formData = new FormData(this);
            formData.append('answers', answers_json);
            formData.append('active', active);
            var shop_id_select = $("#shop_id_select").val();
            var url = '/wifi/' + shop_id_select + '/new_hotspot/survey';
            $.ajax({
                type: 'post', url: url, data: formData, cache: false,
                contentType: false,
                processData: false, success: function (response) {
                    var returnedData = JSON.parse(response);
                    if ('error' in returnedData) {

                        swal(returnedData['error'], " ", "error");
                    } else {
                        var survey_page = '/splash_page/' + shop_id_select + '/hotspot/survey';
                        swal("{{ gettext('Thao_tac_thanh_cong') }}", " ", "success");
                        $(location).attr('href', survey_page)
                    }


                },
                error: function (XMLHttpRequest, textStatus, errorThrown) {
                    swal("{{ gettext('Co_loi_vui_long_thu_lai_sau') }}", " ", "error");
                }
            });
        }));
    })
</script>
{% endblock %}