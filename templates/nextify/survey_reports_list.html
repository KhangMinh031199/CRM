{% extends 'nextify/base.html' %}

{% block main_content %}

<div class="container-fluid">
    <div class="row justify-content-center">
        <div class="col-12 col-lg-10 col-xl-8">
            <div class="header">

                <div class="header-body">
                    <div class="row align-items-end">
                        <div class="col">

                            <!-- Pretitle -->
                            <h6 class="header-pretitle">
                                {{ gettext("Bao_cao_khao_sat") }}
                            </h6>

                            <!-- Title -->
                            <h1 class="header-title">
                                <a href="/surveys_reports/{{ shop_id_select }}">{{ shop_select.name }}</a>
                            </h1>

                        </div>


                        <div class="col-lg-3">

                            <select class="custom-select control-container" id="shop_in_mer">

                                {% for shop_mer in shop_in_mer %}
                                <option value="{{ shop_mer._id }}">{{ shop_mer.name }}</option>
                                {% endfor %}

                            </select>

                        </div>
                        <div class="col-auto">
                            <a class="btn btn-flat d-block d-md-inline-block" href="#new_tag_modal" data-toggle="modal">
                                <i class="fe fe-plus"></i> {{ gettext("Tao_tag_nhanh") }}
                            </a>
                            <input type="hidden" name="status" id="status" value="{{ status }}" />
                        </div>
                        <div class="col-auto">
                            <a data-toggle="modal" href="#new_page_loyal" class="btn btn-danger">
                                {{ gettext("Tao_khao_sat") }}
                            </a>
                        </div>

                    </div> <!-- / .row -->
                </div>

            </div>

            <div class="row justify-content-center">
                {% if total_survey_splash > 0 %}
                <div class="card">


                    <div class="card-body">

                        {% for page in list_survey_splash %}

                        {%endfor%}

                        </div>
                        <div class="card-footer">
                            <ul class="pagination justify-content-center">
                                {% if pagination %}
                                {{ pagination.links }}
                                {% endif %}
                            </ul>
                            </div>

                        </div>


                {% for page in list_survey_splash %}

        

                    <!-- Card -->
                    <div class="card">


                        <div class="card-body">
                            <h2 class="card-title">
                                {{ page.question }}
                            </h2>
                            <p class="small text-muted mb-0">
                                {{ gettext("Tao") }} {{ page.when|human_time }}
                            </p>

                            {% if page.ans_dig|length > 0 %}
                            {% pie_chart page.ans_dig with id=page._id library={"width":"600px"}%}
                            {% else %}
                            <div class="col-12">
                                <h2 class="card-title text-center mb-3">
                                    {{ page.comment_count }} {{ gettext("y_kien") }}
                                </h2>

                            </div>

                            {% endif %}

                            <div class="list-group list-group-flush mb-4">
                                <div class="list-group-item">
                                    <div class="form-group">
                                        <div class="row">
                                            <div class="col">
                                                <label>URL </label>

                                            </div>
                                            <div class="col-auto">
                                                {% if page.unique_id %}
                                                <div class="fb-share-button"
                                                    data-href="https://survey.{{ request.host|get_top_domain }}/{{ page.unique_id }}"
                                                    data-layout="button_count" data-size="large"><a target="_blank"
                                                        href="https://www.facebook.com/sharer/sharer.php?u=https://survey.{{ request.host|get_top_domain }}/{{ page.unique_id }}&amp;src=sdkpreparse"
                                                        class="fb-xfbml-parse-ignore">{{ gettext("Chia_se") }}</a></div>
                                                {% else %}
                                                <div class="fb-share-button"
                                                    data-href="https://survey.{{ request.host|get_top_domain }}/{{ page._id }}"
                                                    data-layout="button_count" data-size="large"><a target="_blank"
                                                        href="https://www.facebook.com/sharer/sharer.php?u=https://survey.{{ request.host|get_top_domain }}/{{ page._id }}&amp;src=sdkpreparse"
                                                        class="fb-xfbml-parse-ignore">{{ gettext("Chia_se") }}</a></div>

                                                {% endif %}

                                            </div>

                                        </div>

                                        {% if page.unique_id %}
                                        <input readonly type="text" class="form-control"
                                            value="https://survey.{{ request.host|get_top_domain }}/{{ page.unique_id }}" />
                                        {% else %}
                                        <input readonly type="text" class="form-control"
                                            value="https://survey.{{ request.host|get_top_domain }}/{{ page._id }}" />
                                        {% endif %}

                                    </div>

                                </div>
                                {% if page.bitly_url and page.bitly_url|length > 0 %}
                                <div class="list-group-item">
                                    <div class="form-group">

                                        <div class="row">
                                            <div class="col">
                                                <label>URL </label>

                                            </div>
                                            <div class="col-auto">
                                                <div class="fb-share-button" data-href="{{ page.bitly_url.url }}"
                                                    data-layout="button_count" data-size="large"><a target="_blank"
                                                        href="https://www.facebook.com/sharer/sharer.php?u={{ page.bitly_url.url }}&amp;src=sdkpreparse"
                                                        class="fb-xfbml-parse-ignore">{{ gettext("Chia_se") }}</a></div>

                                            </div>

                                        </div>


                                        <input readonly type="text" class="form-control"
                                            value="{{ page.bitly_url.url }}" />
                                    </div>
                                </div>
                                {% endif %}

                            </div>



                        </div>
                        <div class="card-footer">
                            <div class="row align-items-center justify-content-between">
                                <div class="col-auto">

                                    <a href="#" class="remove_survey" survey_id="{{ page._id }}"> <small>{{
                                            gettext("Xoa") }}</small></a>

                                </div>
                                <div class="col-auto">

                                    <!-- Link -->
                                    <a href="/surveys_reports/{{ shop_id_select }}/results/{{ page._id }}"
                                        class="btn btn-sm btn-primary">
                                        {{ gettext("Chi_tiet") }}
                                    </a>

                                </div>
                            </div>

                        </div>

                    </div> <!-- / .card-body -->
                
                {% endfor %}
                <ul class="pagination justify-content-center">
                    {% if pagination %}
                    {{ pagination.links }}
                    {% endif %}
                </ul>
                {% else %}

                <div class="col-12 col-md-6 col-xl-4" style="height: auto">

                    <!-- Card -->
                    <div class="card">
                        <div class="card-body">
                            <!-- Image -->
                            <img src="/static/nextify/img/happiness.png" alt="..." class="img-fluid mt-n5 mb-4"
                                style="max-width: 272px;">

                            <!-- Title -->
                            <h2>
                                {{ gettext("Ban_chua_co_chien_dich_khao_sat_nao._Bat_dau_tao_khao_sat_ngay") }}.
                            </h2>

                            <a data-toggle="modal" href="#new_page_loyal" class="btn btn-primary">
                                {{ gettext("Tao_khao_sat") }}
                            </a>

                        </div>

                    </div>


                </div>
                {% endif %}

            </div>

        </div>


    </div>



</div>
<div class="modal hide fade" id="new_tag_modal" tabindex="-1" role="dialog" aria-labelledby="userDetailModal"
    data-backdrop="static" data-focus-on="input:first">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-card card">
                <div class="card-header">
                    <div class="row align-items-center">
                        <div class="col">
                            <!-- Title -->
                            <h4 class="card-header-title" id="exampleModalCenterTitle">
                                {{ gettext("Them_moi_Tag") }}
                            </h4>
                        </div>
                        <div class="col-auto">
                            <!-- Close -->
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close" data-target="#new_tag_modal">
                                <span aria-hidden="true">×</span>
                            </button>
                        </div>
                    </div>
                </div>
                <div class="card-body">
                    <div class="col-lg-12">
                        <div class="row u-mb-medium">
                            <div class="col-lg-12">
                                <form method="POST" action="/create_tags/add" role="form" id="new_tag_fr">
                                    <input type="hidden" name="_csrf_token" value="{{ csrf_token() }}" />
                                    <div class="form-group">
                                        <label for="name">{{ gettext("Ten") }}: (<span>
                                                <font color="red">*</font>
                                            </span> {{ gettext("bat_buoc") }})</label>
                                        <input type="tel" class="form-control" id="name" name="name"
                                            placeholder='{{ gettext("Loai_Tag") }}' />
                                    </div>
                                    <div class="form-group">
                                        <label for="textarea2">{{ gettext("Mo_ta") }}: (<span>
                                                <font color="red">*</font>
                                            </span> {{ gettext("bat_buoc") }})</label>
                                        <textarea class="form-control" id="desc" name="desc"
                                            placeholder='{{ gettext("Mo_ta") }}'></textarea>
                                    </div>
                                    <input type="hidden" name="shop_id_select" value="{{ shop_id_select }}"
                                        id="shop_id_select" />
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="form-group" style="text-align: center">
                    <button id="new_tag_btn" class="btn btn-primary">{{ gettext("Them_moi") }}</button>
                </div>
            </div>
        </div>
    </div>
</div>
<input type="hidden" value="{{ shop_id_select }}" id="shop_id_select" />
<div class="modal hide fade" id="new_page_loyal" tabindex="-1" role="dialog" aria-labelledby="new_page_loyal"
    data-backdrop="static" style="display: none;" aria-hidden="true">
    <div class="modal-dialog" role="document" style="max-width: 700px">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">{{gettext('HotspotSurveyScreenAddText')}}</h3>
                <a class="close" data-dismiss="modal" aria-label="Close" data-target="#new_page_loyal">
                    <span aria-hidden="true">×</span>
                </a>
            </div>
            <form method="POST" enctype="multipart/form-data" id="form_new_survey">
                <input type="hidden" name="_csrf_token" value="{{ csrf_token() }}" />
                <div class="modal-body">
                    {% if error %}
                    <div class="alert alert-danger alert-dismissible fade show" role="alert">
                        <strong style="color: #fff;">{{ error }}</strong>
                    </div>
                    {% endif %}

                    <div class="form-group">
                        <label for="photo">{{gettext('HotspotSurveyScreenPictureText')}}:</label>
                        <p class="help-block">
                            <img id="img_new_photo" width="200">
                        </p>
                        <!-- <input type="file" class="imgInp" id="new_photo" name="photo"> -->
                        <div class="custom-file">
                            <input type="file" class="custom-file-input"  name="photo" id="new_photo">
                            <label class="custom-file-label">{{ gettext("Tai_anh_nen") }}</label>
                          </div>
                    </div>
                    <script nonce="{{ csp_nonce() }}">
                        $(document).ready(function () {
                            function readURL(input, input_view) {
                                if (input.files && input.files[0]) {
                                    var reader = new FileReader();
                                    var view_id = '#' + input_view;
                                    reader.onload = function (e) {
                                        $(view_id).attr('src', e.target.result);
                                    };

                                    reader.readAsDataURL(input.files[0]);
                                }
                            }

                            function validate(photo) {
                                var file_size = $(photo)[0].files[0].size;
                                var file = $(photo).val();
                                var exts = ['jpg', 'png', 'jpeg'];
                                if (file) {
                                    var get_ext = file.split('.');
                                    get_ext = get_ext.reverse();
                                    if ($.inArray(get_ext[0].toLowerCase(), exts) > -1) {
                                        if (file_size > 1048576) {
                                            return "big_file";
                                        } else {
                                            return true;
                                        }
                                    } else {
                                        return false;
                                    }
                                }

                            }

                            $("#new_photo").change(function () {
                                var validate_photo = validate(this);
                                if (validate_photo == true) {
                                    swal('{{ gettext("Upload_thanh_cong") }}', '', 'success');
                                    $('#img_new_photo').show();
                                    readURL(this, 'img_new_photo');
                                } else {
                                    if (validate_photo == "big_file") {
                                        swal('{{ gettext("Kich_thuoc_file_phai_duoi_1MB") }}!', '', 'error');
                                        return false
                                    };
                                    swal('{{ gettext("File_khong_dung_dinh_dang") }}', '', 'error');
                                    $('#new_photo').val('');
                                    $('#img_new_photo').hide();

                                }
                            });
                        });
                    </script>
                    <div class="form-group">

                        <label>
                            {{ gettext("Loai_khao_sat") }}
                        </label>
                        {% if dealer_id == "5de0db6306e7eca17bd8e872" %}
                        <select class="form-control" id="survey_type" name="survey_type">
                            <option value="rating">{{gettext('HotspotSurveyScreenRateText')}}</option>
                        </select>
                        {% else %}
                        <select class="form-control" id="survey_type" name="survey_type">
                            <option value="multi_select"> {{gettext('HotspotSurveyScreenMultipleText')}}</option>
                            <option value="one_select"> {{gettext('HotspotSurveyScreenSingleText')}}</option>
                            <option value="rating">{{gettext('HotspotSurveyScreenRateText')}}</option>
                        </select>
                        {% endif %}

                    </div>
                    {% if dealer_id == "5de0db6306e7eca17bd8e872" %}
                    <div class="row align-items-end" style="padding-top: 10px; padding-bottom: 10px">
                        <div class="col-12">
                            <!-- Pretitle -->
                            <label>
                                {{ gettext("Cau_hoi") }} 1
                            </label>
                            <input type="text" class="form-control" id="question_1" name="question_1"
                                placeholder='{{ gettext("Tong_dai_va_dich_vu_tra_loi_truoc_khi_len_xe?") }}' />
                        </div>
                    </div>
                    <div class="row align-items-end" style="padding-top: 10px; padding-bottom: 10px">
                        <div class="col-12">
                            <!-- Pretitle -->
                            <label>
                                {{ gettext("Cau_hoi_2") }}
                            </label>
                            <input type="text" class="form-control" id="question_2" name="question_2"
                                placeholder='{{ gettext("Thai_do_va_cach_phuc_vu_cua_tai_xe_va_tiep_vien") }}' />
                        </div>
                    </div>
                    <div class="row align-items-end" style="padding-top: 10px; padding-bottom: 10px">
                        <div class="col-12">
                            <!-- Pretitle -->
                            <label>
                                {{ gettext("Cau_hoi") }} 3
                            </label>
                            <input type="text" class="form-control" id="question_3" name="question_3"
                                placeholder='{{ gettext("Chat_luong_phuong_tien_van_chuyen") }}' />
                        </div>
                    </div>
                    <div class="row align-items-end" style="padding-top: 10px; padding-bottom: 10px">
                        <div class="col-12" id="rating_anvui">
                            <div class="form-group">
                                <div class="row">
                                    <div class="col-lg-6">
                                        <label>{{ gettext("Diem_tu:") }} </label>
                                        <input type="text" class="form-control" value="" id="min_point" name="min_point"
                                            placeholder="1" />
                                    </div>
                                    <div class="col-lg-6">
                                        <label>{{ gettext("den") }}: </label>
                                        <input type="text" class="form-control" value="" id="max_point" name="max_point"
                                            placeholder="10" />
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row align-items-end" style="padding-top: 10px; padding-bottom: 10px">
                        <div class="col-12">
                            <!-- Pretitle -->
                            <label>
                                {{ gettext("Tieu_de") }}
                            </label>
                            <input type="text" class="form-control" id="title_anvui" name="title_anvui"
                                placeholder="{{gettext('HotspotSurveyScreenPlaceholderText')}}"
                                value="{{ shop_select.welcome_member_text_splash or 'CẢM ƠN BẠN {{ name }}' }}" />
                        </div>
                    </div>
                    <div class="row align-items-end" style="padding-top: 10px; padding-bottom: 10px">
                        <div class="col-12">
                            <!-- Pretitle -->
                            <label>
                                {{ gettext("Noi_dung") }}
                            </label>
                            <textarea class="form-control" id="content_anvui" name="content_anvui" rows="3"
                                value="{{ shop_select.welcome_member_text_splash or 'Đã tin tưởng sử dụng dịch vụ của Nhà Xe {{ shop_name }} Vui lòng cho chúng tôi xin nhận xét đánh giá của bạn về dịch vụ và chất lượng của nhà xe để cỏ thể phục vụ bạn tốt hơn trong tương lai.' }}">Đã tin tưởng sử dụng dịch vụ của Nhà Xe {{ shop_name }} Vui lòng cho chúng tôi xin nhận xét đánh giá của bạn về dịch vụ và chất lượng của nhà xe để cỏ thể phục vụ bạn tốt hơn trong tương lai
                                </textarea>
                        </div>
                    </div>
                    <div class="row align-items-end" style="padding-top: 10px; padding-bottom: 10px">
                        <div class="col-12">
                            <div class="form-group">
                                <label for="auto_popup">{{gettext('HotspotSurveyScreenRedirectText')}}:</label>
                                <input type="text" class="form-control" id="auto_popup" name="auto_popup"
                                    placeholder="">
                            </div>
                        </div>
                    </div>
                    <div class="row align-items-end" style="padding-top: 10px; padding-bottom: 10px">
                        <div class="col-12">
                            <div class="form-group">
                                <div class="form-group">
                                    <label>{{gettext('HotspotSurveyScreenActiveText')}}</label>
                                    <input type="checkbox" name="active" id="active" class="form-control">
                                </div>
                            </div>
                        </div>
                    </div>
                    {% else %}
                    <div class="form-group">
                        <!-- Pretitle -->
                        <label>
                            {{ gettext("Cau_hoi") }}
                        </label>
                        <input type="text" class="form-control" id="question" name="question"
                            placeholder="{{gettext('HotspotSurveyScreenPlaceholderText')}}" />
                    </div>

                    <div class="form-group" id="multi_select">
                        <label>
                            {{gettext('HotspotSurveyScreenResultText')}}
                        </label>


                        <div id="an_multi_select">
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <input type="text" placeholder='{{ gettext("Noi_dung") }}'
                                            class="form-control" />
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <select class="form-control">
                                            <option value="">{{ gettext("Chon_Tag") }}</option>
                                            {% for tag in tags %}
                                            <option id="{{ tag._id }}" value="{{ tag._id }}">{{ tag.name }}
                                            </option>
                                            {% endfor %}
                                        </select>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <input type="text" placeholder='{{ gettext("Noi_dung") }}'
                                            class="form-control" />
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <select class="form-control">
                                            <option value="">{{ gettext("Chon_Tag") }}</option>

                                            {% for tag in tags %}

                                            <option id="{{ tag._id }}" value="{{ tag._id }}">{{ tag.name }}
                                            </option>
                                            {% endfor %}
                                        </select>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <input type="text" placeholder='{{ gettext("Noi_dung") }}'
                                            class="form-control" />
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <select class="form-control">
                                            <option value="">{{ gettext("Chon_Tag") }}</option>
                                            {% for tag in tags %}
                                            <option id="{{ tag._id }}" value="{{ tag._id }}">{{ tag.name }}
                                            </option>
                                            {% endfor %}
                                        </select>
                                    </div>
                                </div>
                            </div>

                        </div>
                        <div class="form-group">
                            <a id="new_result_multi" class="btn btn-outline-primary u-float-right">
                                <i class="fa fa-plus"></i> {{ gettext("Them_dap_an") }}
                            </a>
                        </div>
                    </div>
                    <div class="form-group" id="one_select">
                        <label>
                            {{gettext('HotspotSurveyScreenResultText')}}
                        </label>
                        <div id="an_one_select">
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <input type="text" placeholder='{{ gettext("Noi_dung") }}'
                                            class="form-control" />
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <select class="form-control">
                                            <option value="">{{ gettext("Chon_Tag") }}</option>
                                            {% for tag in tags %}
                                            <option id="{{ tag._id }}" value="{{ tag._id }}">{{ tag.name }}
                                            </option>
                                            {% endfor %}
                                        </select>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <input type="text" placeholder='{{ gettext("Noi_dung") }}'
                                            class="form-control" />
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <select class="form-control">
                                            <option value="">{{ gettext("Chon_Tag") }}</option>
                                            {% for tag in tags %}
                                            <option id="{{ tag._id }}" value="{{ tag._id }}">{{ tag.name }}
                                            </option>
                                            {% endfor %}
                                        </select>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <input type="text" placeholder='{{ gettext("Noi_dung") }}'
                                            class="form-control" />
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <select class="form-control">
                                            <option value="">{{ gettext("Chon_Tag") }}</option>
                                            {% for tag in tags %}
                                            <option id="{{ tag._id }}" value="{{ tag._id }}">{{ tag.name }}
                                            </option>
                                            {% endfor %}
                                        </select>
                                    </div>
                                </div>
                            </div>

                        </div>
                        <div class="form-group">
                            <a id="new_result_single" class="btn btn-outline-primary u-float-right" href="#">
                                <i class="fa fa-plus"></i> {{ gettext("Them_dap_an") }}
                            </a>
                        </div>
                    </div>
                    <div id="rating" class="form-group">
                        <div class="row">
                            <div class="col-lg-6">
                                <label>{{ gettext("Diem_tu:") }} </label>
                                <input type="text" class="form-control" value="" id="min_point" name="min_point"
                                    placeholder="1" />
                            </div>
                            <div class="col-lg-6">
                                <label>{{ gettext("den") }}: </label>
                                <input type="text" class="form-control" value="" id="max_point" name="max_point"
                                    placeholder="10" />
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>{{ gettext("Nut_xac_nhan_khao_sat") }}</label>
                        <input type="text" class="form-control method-form-control" id="connect_button"
                            name="connect_button">
                    </div>
                    <div class="form-group row mt-5">
                        <div class="col-2">
                            <span>{{ gettext("Mau_nut") }}</span>
                        </div>
                        <div class="col-2">
                            <input type="color" class="" id="connect_button_color" name="connect_button_color"
                                value="#f57a33">
                        </div>
                    </div>
                    <div class="form-group row mt-5">

                        <span class="col-4">
                            {{ gettext("Hien_thị_dong_gop_y_kien") }}

                        </span>
                        <div class="custom-control custom-switch">
                            <input type="checkbox" class="custom-control-input" id="active_comment"
                                name="active_comment" checked>
                            <label class="custom-control-label" for="active_comment"></label>
                        </div>
                    </div>
                    {% endif %}
                    <div class="modal-footer">
                        <button class="btn btn-lg btn-primary u-float-right" type="submit">
                            {{gettext('HotspotUpdateText')}}
                        </button>
                    </div>
                </div>
            </form>
        </div><!-- // .c-modal__content -->
    </div><!-- // .c-modal__dialog -->
</div>
<input type="hidden" name="dealer_id" id="dealer_id" value="{{ dealer_id }}" />

{% endblock %}
{% block js %}
<script nonce="{{ csp_nonce() }}">
    $(document).ready(function () {
        $('#new_tag_modal').on('shown.bs.modal', function () {
          $('#name').trigger('focus');
        });
        $('#new_page_loyal').on('shown.bs.modal', function () {
            $('#survey_type').trigger('focus');
        });
        $("#new_tag_btn").click(function () {
            var name = $("#name").val();
            var desc = $("#desc").val();

            if (name.length == 0) {
                swal('{{ gettext("Ten_Tag_khong_duoc_de_trong") }}', " ", "error");
                return false;

            }
            if (desc.length == 0) {
                swal('{{ gettext("Mo_ta_khong_duoc_de_trong") }}', " ", "error");
                return false;

            }
            $.ajax({
                url: '/test_ajax_create_tag',
                type: $("#new_tag_fr").attr("method"),
                data: $("#new_tag_fr").serialize(),

                success: function (response) {
                    var returnedData = JSON.parse(response);
                    if ('error' in returnedData) {

                        swal(returnedData['error'], " ", "error");
                    } else {
                        $("#new_tags_selects").select2({
                            'data': returnedData
                        });
                        $('#new_tag_modal').modal('hide');
                        $('body').removeClass('modal-open');
                        $('.modal-backdrop').remove();
                        $.ajax({
                            url: "/hotspot_type/survey",
                            type: 'GET',
                            data: {
                                'shop_id_select': '{{ shop_id_select }}'
                            },
                            beforeSend: function () {
                                $(".detail-splash").empty();
                            },
                            success: function (data) {
                                swal(ngettext("Thanh_cong"), " ", "success");
                                $(".detail-splash").append(data);
                                location.reload();
                            }

                        });
                    }
                },
                error: function (xhr, desc, err) {
                    swal('{{ gettext("Co_loi_xay_ra,_thu_lai_sau") }}', " ", "error");


                }
            })
        });
        $('#shop_in_mer').select2();
        $('#shop_in_mer').val($('#shop_id_select').val()).trigger('change');
        $('#shop_in_mer').on("change", function (e) {
            var shop_id = $('#shop_in_mer').val();
            var url = "/surveys_reports/" + shop_id;
            $(location).attr('href', url);
        });
        var shop_id_select = $('#shop_id_select').val();
        $(".remove_survey").click(function () {
            var survey_id = $(this).attr('survey_id');
            Swal.fire({
                title: '{{ gettext("Ban_co_chac_chan_muon_xoa_khong?") }}',
                type: 'warning',
                focusCancel: true,
                showCancelButton: true,
                confirmButtonColor: '#3085d6',
focusCancel: true,
                cancelButtonColor: '#d33',
                confirmButtonText: 'Có!',
                cancelButtonText: '{{ gettext("Khong!")}}'
            }).then((result) => {
                if (result.value) {
                    var url_submit = '/surveys_reports/' + shop_id_select + '/remove/' + survey_id;
                    $.ajax({
                        url: url_submit,
                        type: 'GET',
                        success: function (data) {
                            swal('{{ gettext("Xoa_thanh_cong") }}', '', 'success');
                            location.reload();
                        }
                    });
                }
            });
        });
        $("#multi_select").show();
        $("#one_select").hide();
        $("#rating").hide();

        $('#survey_type').on("change", function (e) {
            var survey_type = $('#survey_type').val();
            if (survey_type == 'multi_select') {
                $("#multi_select").show();
                $("#one_select").hide();
                $("#rating").hide();

            } else if (survey_type == 'one_select') {
                $("#multi_select").hide();
                $("#one_select").show();
                $("#rating").hide();

            } else if (survey_type == 'rating') {
                $("#multi_select").hide();
                $("#one_select").hide();
                $("#rating").show();


            } else if (survey_type == 'comment') {
                $("#multi_select").hide();
                $("#one_select").hide();
                $("#rating").hide();

            }

        });
        $("#new_result_multi").click(function () {
            $("#an_multi_select").append('<div class="row">\n' +
                ' <div class="col-md-6">\n' +
                '    <div class="form-group">\n' +
                '  <input type="text" placeholder="{{ gettext('+ '"Noi_dung") }}" class="form-control"/>\n' +
                '</div>\n' +

                '  </div>\n' +
                '<div class="col-md-6">\n' +
                '<div class="form-group">\n' +
                '<select placeholder="Tag" class="form-control">\n' +
                '<option value="">{{ gettext("Chon_Tag") }}</option>\n' +
                '{% for tag in tags %}\n' +
                '<option id="{{ tag._id }}" value="{{ tag._id }}">{{ tag.name }}</option>\n' +
                '{% endfor %}</select>\n' +

                '  </div>\n' +

                ' </div>\n' +
            ' </div>');
        });
        $("#new_result_single").click(function () {
            $("#an_one_select").append('<div class="row">\n' +
                ' <div class="col-md-6">\n' +
                '    <div class="form-group">\n' +
                '  <input type="text" placeholder="{{ gettext(' + '"Noi_dung") }}" class="form-control"/>\n' +
                '</div>\n' +

                '  </div>\n' +
                '<div class="col-md-6">\n' +
                '<div class="form-group">\n' +
                '<select placeholder="Tag" class="form-control">\n' +
                '<option value="">{{ gettext("Chon_Tag") }}</option>\n' +
                '{% for tag in tags %}\n' +
                '<option id="{{ tag._id }}" value="{{ tag._id }}">{{ tag.name }}</option>\n' +
                '{% endfor %}</select>\n' +

                '  </div>\n' +

                ' </div>\n' +
            ' </div>');
        });
        $("#form_new_survey").on('submit', (function (e) {
            e.preventDefault();
            var survey_type = $("#survey_type").val();
            var answers = [];
            var question = $("#question").val();
            var dealer_id = $("#dealer_id").val();
            if (survey_type == '0') {

                swal('{{ gettext("Ban_chua_chon_loai_khao_sat") }}', " ", "error");
                return false;
            };
            if (dealer_id != '5de0db6306e7eca17bd8e872') {
                if (question.length == '0') {
                    swal("{{ gettext('Ban_chua_nhap') }} {{gettext('HotspotSurveyScreenQuestionText')}}", " ", "error");
                    return false;
                }
            };
            if (survey_type == 'multi_select') {
                $("#an_multi_select").children('div.row').each(function (i) {
                    var item = [];
                    $(this).find(':input').each(function () {
                        item.push($(this).val());
                    });
                    var name_ranks = item[0];
                    var points_ranks = item[1];
                    if (name_ranks.length > 0) {
                        var item_array = { 'id': i, 'value': name_ranks, 'tag': points_ranks };
                        answers.push(item_array);
                    }

                });

            }

            if (survey_type == 'one_select') {
                $("#an_one_select").children('div.row').each(function (i) {
                    var item = [];
                    $(this).find(':input').each(function (e) {

                        item.push($(this).val());
                    });
                    var name_ranks = item[0];
                    var points_ranks = item[1];
                    if (name_ranks.length > 0) {
                        var item_array = { 'id': i, 'value': name_ranks, 'tag': points_ranks };
                        answers.push(item_array);
                    }
                });

            }
            if (survey_type == 'rating') {

                if ($("#max_point").val().length == 0) {
                    swal('{{ gettext("Ban_chua_nhap_thang_diem") }}', " ", "error");
                    return false;

                }
                if ($("#min_point").val().length == 0) {
                    swal('{{ gettext("Ban_chua_nhap_thang_diem") }}', " ", "error");
                    return false;

                }

            }
            var answers_json = JSON.stringify(answers);
            var active = $("#active").is(":checked");
            var formData = new FormData(this);
            formData.append('answers', answers_json);
            formData.append('active', active);
            var shop_id_select = $("#shop_id_select").val();
            var url = '/new_wifi/' + shop_id_select + '/new_hotspot/survey';
            $.ajax({
                headers: { "X-CSRFToken": '{{ csrf_token() }}' },
                type: 'post',
                url: url,
                data: formData,
                cache: false,
                contentType: false,
                processData: false,
                success: function (response) {
                    var returnedData = JSON.parse(response);
                    if ('error' in returnedData) {

                        swal(returnedData['error'], " ", "error");
                        return false;
                    } else {
                        swal(ngettext("Thanh_cong"), " ", "success");
                        location.reload();
                    }


                },
                error: function (XMLHttpRequest, textStatus, errorThrown) {
                    swal('{{ gettext("Co_loi_xay_ra,_thu_lai_sau") }}', " ", "error");
                    return false;
                }
            });
        }));

    });
</script>
{% endblock %}